<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Raleway:300,300italic,400,400italic,700,700italic|New+Rocker:300,300italic,400,400italic,700,700italic|Fira+Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  
  <link rel="stylesheet" href="/lib/animate-css/animate.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"merikanto.org","root":"/","scheme":"Muse","version":"8.0.0-rc.5","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":true,"color":"#6bb0e8","save":"manual"},"fancybox":true,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"buttons","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"path":"search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":3,"unescape":false,"preload":false}};
  </script>

  <meta name="description" content="HAProxy is a popular open source software TCP&#x2F;HTTP Load Balancer and proxying solution which can be run on Linux, Solaris, and FreeBSD. Its most common use is to improve the performance and reliabilit">
<meta property="og:type" content="article">
<meta property="og:title" content="HAProxy &amp; Load Balancing">
<meta property="og:url" content="http://merikanto.org/2018/Load-Balancer/index.html">
<meta property="og:site_name" content="Merikanto">
<meta property="og:description" content="HAProxy is a popular open source software TCP&#x2F;HTTP Load Balancer and proxying solution which can be run on Linux, Solaris, and FreeBSD. Its most common use is to improve the performance and reliabilit">
<meta property="og:locale" content="de_DE">
<meta property="og:image" content="http://merikanto.org/img/181122-1.png">
<meta property="og:image" content="http://merikanto.org/img/181122-2.png">
<meta property="og:image" content="http://merikanto.org/img/181122-3.png">
<meta property="og:image" content="http://merikanto.org/img/181122-5.png">
<meta property="og:image" content="http://merikanto.org/img/181122-6.png">
<meta property="og:image" content="http://merikanto.org/2018/Load-Balancer/181122-7.png">
<meta property="og:image" content="http://merikanto.org/img/181122-4.gif">
<meta property="article:published_time" content="2018-11-22T00:00:00.000Z">
<meta property="article:modified_time" content="2018-11-22T00:00:00.000Z">
<meta property="article:author" content="Merikanto">
<meta property="article:tag" content="DevOps">
<meta property="article:tag" content="Linux">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://merikanto.org/img/181122-1.png">

<link rel="canonical" href="http://merikanto.org/2018/Load-Balancer/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'de'
  };
</script>

  <title>HAProxy & Load Balancing | Merikanto</title>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

<style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}</style></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <main class="main">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader">
        <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Navigationsleiste an/ausschalten">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Merikanto</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">一簫一劍平生意，負盡狂名十五年</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-blog">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Blog</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Kategorien</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Zeitleiste</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>Info</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Suchen
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Suchbegriff..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Übersicht
        </li>
        <li class="sidebar-nav-overview">
          Info
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
          <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#HAProxy-Terminology"><span class="nav-number">1.</span> <span class="nav-text">HAProxy Terminology</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Access-Control-List-ACL"><span class="nav-number">1.1.</span> <span class="nav-text">Access Control List (ACL)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Backend"><span class="nav-number">1.2.</span> <span class="nav-text">Backend</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Frontend"><span class="nav-number">1.3.</span> <span class="nav-text">Frontend</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Types-of-Load-Balancing"><span class="nav-number">2.</span> <span class="nav-text">Types of Load Balancing</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#No-Load-Balancing"><span class="nav-number">2.1.</span> <span class="nav-text">No Load Balancing</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Layer-4-Load-Balancing"><span class="nav-number">2.2.</span> <span class="nav-text">Layer 4 Load Balancing</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Layer-7-Load-Balancing"><span class="nav-number">2.3.</span> <span class="nav-text">Layer 7 Load Balancing</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Load-Balancing-Algorithms"><span class="nav-number">3.</span> <span class="nav-text">Load Balancing Algorithms</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#roundrobin"><span class="nav-number">3.1.</span> <span class="nav-text">roundrobin</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#leastconn"><span class="nav-number">3.2.</span> <span class="nav-text">leastconn</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#source"><span class="nav-number">3.3.</span> <span class="nav-text">source</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Sticky-Sessions"><span class="nav-number">4.</span> <span class="nav-text">Sticky Sessions</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Health-Check"><span class="nav-number">5.</span> <span class="nav-text">Health Check</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Load-Balancer-Use-Cases"><span class="nav-number">6.</span> <span class="nav-text">Load Balancer Use Cases</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Scale"><span class="nav-number">6.1.</span> <span class="nav-text">Scale</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HA"><span class="nav-number">6.2.</span> <span class="nav-text">HA</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Blue-Green-Deployments"><span class="nav-number">6.3.</span> <span class="nav-text">Blue &#x2F; Green Deployments</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Canary-Deployments"><span class="nav-number">6.4.</span> <span class="nav-text">Canary Deployments</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#A-B-Deployment"><span class="nav-number">6.5.</span> <span class="nav-text">A&#x2F;B Deployment</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Other-Solutions"><span class="nav-number">7.</span> <span class="nav-text">Other Solutions</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#High-Availability"><span class="nav-number">8.</span> <span class="nav-text">High Availability</span></a></li></ol></div>
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Merikanto"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Merikanto</p>
  <div class="site-description" itemprop="description">知我罪我，其惟春秋</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">125</span>
          <span class="site-state-item-name">Artikel</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">Kategorien</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">Tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/Merikanto" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Merikanto" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:ks.merikanto@gmail.com" title="E-Mail → mailto:ks.merikanto@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
  </div>


  <div class="links-of-blogroll animated">
    <div class="links-of-blogroll-title">
      　　
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://www.sigure.jp/" title="http:&#x2F;&#x2F;www.sigure.jp&#x2F;" rel="noopener" target="_blank">　凛として時雨　</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://tools.kali.org/tools-listing" title="https:&#x2F;&#x2F;tools.kali.org&#x2F;tools-listing" rel="noopener" target="_blank">All Kali Tools</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.shodan.io/" title="https:&#x2F;&#x2F;www.shodan.io&#x2F;" rel="noopener" target="_blank">Shodan</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://0pointer.net/blog/archives.html" title="https:&#x2F;&#x2F;0pointer.net&#x2F;blog&#x2F;archives.html" rel="noopener" target="_blank">Pid Eins</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.allthingsdistributed.com/" title="https:&#x2F;&#x2F;www.allthingsdistributed.com&#x2F;" rel="noopener" target="_blank">All Things Distributed</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.contrapositivediary.com/?p=1396" title="https:&#x2F;&#x2F;www.contrapositivediary.com&#x2F;?p&#x3D;1396" rel="noopener" target="_blank">Jeff Duntemann</a>
        </li>
    </ul>
  </div>

      </section>
        <div class="back-to-top animated">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </header>

      
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/Merikanto" class="github-corner" title="Check out my GitHub" aria-label="Check out my GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div id="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


      <div class="main-inner">
        

        <div class="content post posts-expand">
          

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="de">
    <link itemprop="mainEntityOfPage" href="http://merikanto.org/2018/Load-Balancer/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Merikanto">
      <meta itemprop="description" content="知我罪我，其惟春秋">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Merikanto">
    </span>

    
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          HAProxy & Load Balancing
        </h1>

        <div class="post-meta">

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Veröffentlicht am</span>

              <time title="Erstellt: 2018-11-22 00:00:00" itemprop="dateCreated datePublished" datetime="2018-11-22T00:00:00+00:00">2018-11-22</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">in</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/DevOps/" itemprop="url" rel="index"><span itemprop="name">DevOps</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="Aufrufe" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="far fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Aufrufe: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="Symbole im Artikel gezählt">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbole im Artikel gezählt: </span>
              <span>11k Wörter</span>
            </span>
            <span class="post-meta-item" title="Lesezeit">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Lesezeit &asymp;</span>
              <span>14 min</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p><strong>HAProxy</strong> is a popular open source software TCP/HTTP Load Balancer and proxying solution which can be run on Linux, Solaris, and FreeBSD. Its most common use is to improve the performance and reliability of a server environment by distributing the workload across multiple servers (e.g. web, application, database). It is used in many high-profile environments, including: GitHub, Imgur, Instagram, and Twitter.</p>
<p><strong>Load Balancers</strong> allow us to <strong>split incoming traffic between multiple backend servers</strong>. Often this is used to distribute HTTP requests among a group of application servers to increase overall capacity. This is a common way to scale the application.</p>
<span id="more"></span> 

<p>In this post, we will go through what HAProxy is, basic load-balancing terminology, and examples of how it might be used to improve the performance and reliability of the server environment.</p>
<blockquote>
<p><strong>Reference:</strong></p>
<p><a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/how-to-use-haproxy-to-set-up-mysql-load-balancing--3">Use HAProxy to Set Up MySQL Load Balancing</a></p>
<p><a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/how-to-use-haproxy-as-a-layer-4-load-balancer-for-wordpress-application-servers-on-ubuntu-14-04">Use HAProxy As A Layer 4 Load Balancer</a></p>
<p><a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/an-introduction-to-haproxy-and-load-balancing-concepts">HAProxy and Load Balancing</a></p>
<p><a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/how-to-set-up-highly-available-haproxy-servers-with-keepalived-and-floating-ips-on-ubuntu-14-04">HAProxy with <strong>Keepalived and Floating IP</strong></a></p>
<p><a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/5-digitalocean-load-balancer-use-cases">Load Balancer Use Cases</a></p>
</blockquote>
<br>

<hr>
<h2 id="HAProxy-Terminology"><a href="#HAProxy-Terminology" class="headerlink" title="HAProxy Terminology"></a>HAProxy Terminology</h2><p>There are many terms and concepts that are important when discussing load balancing and proxying. We will go over commonly used terms in the following sub-sections.</p>
<p>Before we get into the basic types of load balancing, we will talk about ACLs, backends, and frontends.</p>
<br>

<h3 id="Access-Control-List-ACL"><a href="#Access-Control-List-ACL" class="headerlink" title="Access Control List (ACL)"></a>Access Control List (ACL)</h3><p>In relation to load balancing, ACLs are used to test some condition and perform an action (e.g. select a server, or block a request) based on the test result. Use of ACLs allows flexible network traffic forwarding based on a variety of factors like pattern-matching and the number of connections to a backend, for example.</p>
<p>Example of an ACL:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">acl</span> <span class="string">url_blog</span> <span class="string">path_beg</span> <span class="string">/blog</span></span><br></pre></td></tr></table></figure>

<p>This ACL is matched if the path of a user’s request begins with /blog. This would match a request of <a target="_blank" rel="noopener" href="http://domain/blog/blog-entry-1">http://domain/blog/blog-entry-1</a>, for example.</p>
<br>

<h3 id="Backend"><a href="#Backend" class="headerlink" title="Backend"></a>Backend</h3><p>A backend is a set of servers that receives forwarded requests. Backends are defined in the backend section of the HAProxy configuration. In its most basic form, a backend can be defined by:</p>
<ul>
<li><p>which load balance algorithm to use</p>
</li>
<li><p>a list of servers and ports</p>
</li>
</ul>
<p>A backend can contain one or many servers in it–generally speaking, adding more servers to your backend will increase your potential load capacity by spreading the load over multiple servers. Increase reliability is also achieved through this manner, in case some of your backend servers become unavailable.</p>
<p>Here is an example of a two backend configuration, web-backend and blog-backend with two web servers in each, listening on port 80:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">backend</span> <span class="string">web-backend</span></span><br><span class="line">   <span class="string">balance</span> <span class="string">roundrobin</span></span><br><span class="line">   <span class="string">server</span> <span class="string">web1</span> <span class="string">web1.yourdomain.com:80</span> <span class="string">check</span></span><br><span class="line">   <span class="string">server</span> <span class="string">web2</span> <span class="string">web2.yourdomain.com:80</span> <span class="string">check</span></span><br><span class="line"></span><br><span class="line"><span class="string">backend</span> <span class="string">blog-backend</span></span><br><span class="line">   <span class="string">balance</span> <span class="string">roundrobin</span></span><br><span class="line">   <span class="string">mode</span> <span class="string">http</span></span><br><span class="line">   <span class="string">server</span> <span class="string">blog1</span> <span class="string">blog1.yourdomain.com:80</span> <span class="string">check</span></span><br><span class="line">   <span class="string">server</span> <span class="string">blog1</span> <span class="string">blog1.yourdomain.com:80</span> <span class="string">check</span></span><br></pre></td></tr></table></figure>

<p>The <code>balance roundrobin</code> line specifies the load balancing algorithm, <code>mode http</code> specifies that layer 7 proxying will be used, which is explained in Types of Load Balancing section.</p>
<p>The check option at the end of the server directives specifies that health checks should be performed on those backend servers.</p>
<br>

<h3 id="Frontend"><a href="#Frontend" class="headerlink" title="Frontend"></a>Frontend</h3><p>A frontend defines how requests should be forwarded to backends. Frontends are defined in the frontend section of the HAProxy configuration. Their definitions are composed of the following components:</p>
<ul>
<li>a set of IP addresses and a port (e.g. 10.1.1.7:80, *:443, etc.)</li>
<li>ACLs</li>
<li>use_backend rules, which define which backends to use depending on which ACL conditions are matched, and/or a default_backend rule that handles every other case</li>
</ul>
<p>A frontend can be configured to various types of network traffic, as explained in the next section.</p>
<br>

<hr>
<h2 id="Types-of-Load-Balancing"><a href="#Types-of-Load-Balancing" class="headerlink" title="Types of Load Balancing"></a>Types of Load Balancing</h2><p>Now that we have an understanding of the basic components that are used in load balancing, let’s get into the basic types of load balancing.</p>
<br>

<h3 id="No-Load-Balancing"><a href="#No-Load-Balancing" class="headerlink" title="No Load Balancing"></a>No Load Balancing</h3><p>A simple web application environment with no load balancing might look like the following:</p>
<p><img data-src="/img/181122-1.png" alt="01"></p>
<p>In this example, the user connects directly to your web server, at <code>yourdomain.com</code> and there is no load balancing. If your single web server goes down, the user will no longer be able to access your web server. Additionally, if many users are trying to access your server simultaneously and it is unable to handle the load, they may have a slow experience or they may not be able to connect at all.</p>
<br>

<h3 id="Layer-4-Load-Balancing"><a href="#Layer-4-Load-Balancing" class="headerlink" title="Layer 4 Load Balancing"></a>Layer 4 Load Balancing</h3><p>The simplest way to load balance network traffic to multiple servers is to use layer 4 (transport layer) load balancing. Load balancing this way will forward user traffic based on IP range and port (i.e. if a request comes in for <a target="_blank" rel="noopener" href="http://yourdomain.com/anything">http://yourdomain.com/anything</a>, the traffic will be forwarded to the backend that handles all the requests for <code>yourdomain.com</code> on port 80). For more details on layer 4, check out the TCP subsection of our Introduction to Networking.</p>
<br>

<p>Here is a diagram of a simple example of layer 4 load balancing:</p>
<p><img data-src="/img/181122-2.png" alt="02"></p>
<p>The user accesses the load balancer, which forwards the user’s request to the web-backend group of backend servers. Whichever backend server is selected will respond directly to the user’s request. Generally, all of the servers in the web-backend should be serving identical content–otherwise the user might receive inconsistent content. Note that both web servers connect to the same database server.</p>
<br>

<h3 id="Layer-7-Load-Balancing"><a href="#Layer-7-Load-Balancing" class="headerlink" title="Layer 7 Load Balancing"></a>Layer 7 Load Balancing</h3><p>Another, more complex way to load balance network traffic is to use layer 7 (application layer) load balancing. Using layer 7 allows the load balancer to forward requests to different backend servers based on the content of the user’s request. This mode of load balancing allows you to run multiple web application servers under the same domain and port. For more details on layer 7, check out the HTTP subsection of our Introduction to Networking.</p>
<br>

<p>Here is a diagram of a simple example of layer 7 load balancing:</p>
<p><img data-src="/img/181122-3.png" alt="03"></p>
<p>In this example, if a user requests yourdomain.com/blog, they are forwarded to the blog backend, which is a set of servers that run a blog application. Other requests are forwarded to web-backend, which might be running another application. Both backends use the same database server, in this example.</p>
<p>A snippet of the example frontend configuration would look like this:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">frontend</span> <span class="string">http</span></span><br><span class="line">  <span class="string">bind</span> <span class="string">*:80</span></span><br><span class="line">  <span class="string">mode</span> <span class="string">http</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># matches a request if the path of the user’s request begins with /blog</span></span><br><span class="line">  <span class="string">acl</span> <span class="string">url_blog</span> <span class="string">path_beg</span> <span class="string">/blog</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># uses the ACL to proxy the traffic to blog-backend</span></span><br><span class="line">  <span class="string">use_backend</span> <span class="string">blog-backend</span> <span class="string">if</span> <span class="string">url_blog</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># specifies that all other traffic will be forwarded to web-backend</span></span><br><span class="line">  <span class="string">default_backend</span> <span class="string">web-backend</span></span><br></pre></td></tr></table></figure>

<p>This configures a frontend named <code>http</code>, which handles all incoming traffic on port 80.</p>
<br>

<hr>
<h2 id="Load-Balancing-Algorithms"><a href="#Load-Balancing-Algorithms" class="headerlink" title="Load Balancing Algorithms"></a>Load Balancing Algorithms</h2><p>The load balancing algorithm that is used determines which server, in a backend, will be selected when load balancing. HAProxy offers several options for algorithms. In addition to the load balancing algorithm, servers can be assigned a weight parameter to manipulate how frequently the server is selected, compared to other servers.</p>
<p>Because HAProxy provides so many load balancing algorithms, we will only describe a few of them here. See the HAProxy Configuration Manual for a complete list of algorithms.</p>
<p>A few of the commonly used algorithms are as follows:</p>
<br>

<h3 id="roundrobin"><a href="#roundrobin" class="headerlink" title="roundrobin"></a>roundrobin</h3><p>Round Robin selects servers in turns. This is the default algorithm.</p>
<br>

<h3 id="leastconn"><a href="#leastconn" class="headerlink" title="leastconn"></a>leastconn</h3><p>Selects the server with the least number of connections–it is recommended for longer sessions. Servers in the same backend are also rotated in a round-robin fashion.</p>
<br>

<h3 id="source"><a href="#source" class="headerlink" title="source"></a>source</h3><p>This selects which server to use based on a hash of the source IP i.e. your user’s IP address. This is one method to ensure that a user will connect to the same server.</p>
<br>

<hr>
<h2 id="Sticky-Sessions"><a href="#Sticky-Sessions" class="headerlink" title="Sticky Sessions"></a>Sticky Sessions</h2><p>Some applications require that a user continues to connect to the same backend server. This persistence is achieved through sticky sessions, using the <code>appsession</code> parameter in the backend that requires it.</p>
<br>

<hr>
<h2 id="Health-Check"><a href="#Health-Check" class="headerlink" title="Health Check"></a>Health Check</h2><p>HAProxy uses health checks to determine if a backend server is available to process requests. This avoids having to manually remove a server from the backend if it becomes unavailable. The default health check is to try to establish a TCP connection to the server i.e. it checks if the backend server is listening on the configured IP address and port.</p>
<p>If a server fails a health check, and therefore is unable to serve requests, it is automatically disabled in the backend i.e. traffic will not be forwarded to it until it becomes healthy again. If all servers in a backend fail, the service will become unavailable until at least one of those backend servers becomes healthy again.</p>
<p>For certain types of backends, like database servers in certain situations, the default health check is insufficient to determine whether a server is still healthy.</p>
<br>

<hr>
<h2 id="Load-Balancer-Use-Cases"><a href="#Load-Balancer-Use-Cases" class="headerlink" title="Load Balancer Use Cases"></a>Load Balancer Use Cases</h2><p>Although Load Balancers (LB) are most often considered when <strong>scale</strong> is needed, we’ve shown that there are many other cases where it’s useful to have the ability to distribute or shuffle traffic among various backend servers. Whether it’s for <strong>high availability</strong> or leveraging various <strong>deployment</strong> techniques, Load Balancers are a flexible and powerful tool in your production infrastructure.</p>
<br>

<h3 id="Scale"><a href="#Scale" class="headerlink" title="Scale"></a>Scale</h3><p>As mentioned above, scaling traffic is the most common use case for a Load Balancer. Often times scaling is discussed in vertical and horizontal terms. Vertical scaling is basically moving your application to a more powerful server to meet increasing performance demands. Horizontal scaling is distributing your traffic among multiple servers to share the load. Load Balancers facilitate horizontal scaling.</p>
<p><img data-src="/img/181122-5.png" alt="05"></p>
<p>Load Balancers allow you to distribute load via two different algorithms: round robin and least connections. Round robin will send requests to each available backend server in turn, whereas least connections will send requests to the server with the fewest connections. Round robin is by far the most frequently used scheme for load balancing, but if you have an application that keeps connections open for a long time, least connections may do a better job of preventing any one server from becoming overloaded.</p>
<p>A side benefit of horizontal scaling with load balancers is the chance to increase your service’s reliability. We’ll talk about that next.</p>
<br>

<h3 id="HA"><a href="#HA" class="headerlink" title="HA"></a>HA</h3><p>High availability is a term that describes efforts to decrease downtime and increase system reliability. This is often addressed by improving performance and eliminating single points of failure.</p>
<p>A Load Balancer can increase availability by performing repeated health checks on your backend servers and automatically removing failed servers from the pool.</p>
<p><img data-src="/img/181122-6.png" alt="06"></p>
<p>By default, the Load Balancer will fetch a web page every ten seconds to make sure the server is responding properly. If this fails three times in a row, the server will be removed until the problem is resolved.</p>
<br>

<h3 id="Blue-Green-Deployments"><a href="#Blue-Green-Deployments" class="headerlink" title="Blue / Green Deployments"></a>Blue / Green Deployments</h3><p>Blue/green deployments refer to a technique where you deploy your new software on production infrastructure, test it thoroughly, then switch traffic over to it only after verifying that everything is working as you expect. If the deploy ends up failing in new and unexpected ways, you can easily recover by switching the Load Balancer back to the old version.</p>
<p><img data-src="181122-7.png" alt="07"></p>
<br>

<h3 id="Canary-Deployments"><a href="#Canary-Deployments" class="headerlink" title="Canary Deployments"></a>Canary Deployments</h3><p>Canary deployments are a way of testing a new version of your application on a subset of users before updating your entire pool of application servers. With Load Balancers you could do this by, for instance, adding just one canary server to your Load Balancer’s pool. If you don’t see any increase in errors or other undesirable results through your logging and monitoring infrastructure, you can then proceed to deploy updates to the rest of the pool.</p>
<p>You’ll want to turn on sticky sessions for this use case, so that your users aren’t bounced between different versions of your application when making new connections through the Load Balancer. Sticky sessions will use a cookie to ensure that future connections from a particular browser will continue to be routed to the same server. </p>
<br>

<h3 id="A-B-Deployment"><a href="#A-B-Deployment" class="headerlink" title="A/B Deployment"></a>A/B Deployment</h3><p>A/B deployments are functionally similar to canary deployments, but the purpose is different. A/B deployments test a new feature on a portion of your users in order to gather information that will inform your marketing and development efforts. You’ll need to do this in conjunction with your existing monitoring and logging infrastructure to get back meaningful results.</p>
<br>

<hr>
<h2 id="Other-Solutions"><a href="#Other-Solutions" class="headerlink" title="Other Solutions"></a>Other Solutions</h2><p>If you feel like HAProxy might be too complex for your needs, the following solutions may be a better fit:</p>
<ul>
<li><p>Linux Virtual Servers (LVS) - A simple, fast layer 4 load balancer included in many Linux distributions</p>
</li>
<li><p>Nginx - A fast and reliable web server that can also be used for proxy and load-balancing purposes. Nginx is often used in conjunction with HAProxy for its caching and compression capabilities</p>
</li>
</ul>
<br>

<hr>
<h2 id="High-Availability"><a href="#High-Availability" class="headerlink" title="High Availability"></a>High Availability</h2><p>The layer 4 and 7 load balancing setups described before both use a load balancer to direct traffic to one of many backend servers. However, your load balancer is a single point of failure in these setups; if it goes down or gets overwhelmed with requests, it can cause high latency or downtime for your service.</p>
<p>A high availability (HA) setup is an infrastructure without a single point of failure. It prevents a single server failure from being a downtime event by adding redundancy to every layer of your architecture. A load balancer facilitates redundancy for the backend layer (web/app servers), but for a true high availability setup, you need to have redundant load balancers as well.</p>
<br>

<p>Here is a diagram of a basic high availability setup:</p>
<p><img data-src="/img/181122-4.gif" alt="04"></p>
<p>In this example, you have multiple load balancers (one active and one or more passive) behind a static IP address that can be remapped from one server to another. When a user accesses your website, the request goes through the external IP address to the active load balancer. If that load balancer fails, your failover mechanism will detect it and automatically reassign the IP address to one of the passive servers, and there are a number of different ways to implement an active/passive HA setup. </p>
<br>

<br>


    </div>

    
    
    <div>
    
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>Beitragsautor:  </strong>Merikanto
  </li>
  <li class="post-copyright-link">
    <strong>Beitragslink: </strong>
    <a href="http://merikanto.org/2018/Load-Balancer/" title="HAProxy &amp; Load Balancing">http://merikanto.org/2018/Load-Balancer/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Urheberrechtshinweis:  </strong>Alle Artikel in diesem Blog sind unter <a target="_blank" rel="noopener" href="https://github.com/Merikanto">Merikanto</a> lizenziert, außer es wird anders angegeben.
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/DevOps/" rel="tag"><i class="fa fa-tag"></i> DevOps</a>
              <a href="/tags/Linux/" rel="tag"><i class="fa fa-tag"></i> Linux</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2018/Nginx-Config/" rel="prev" title="Nginx as Web Server & Reverse Proxy for Apache with SSL">
      <i class="fa fa-chevron-left"></i> Nginx as Web Server & Reverse Proxy for Apache with SSL
    </a></div>
      <div class="post-nav-item">
    <a href="/2018/Customize-Terminal/" rel="next" title="Customize Mac's Terminal">
      Customize Mac's Terminal <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



        </div>
        
    
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2016 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>  
  </span>
  <a href="/tools"><span class="author" itemprop="copyrightHolder">Merikanto</span></a>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Alle Besucher">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Alle Aufrufe">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>


  




  
<script src="/js/local-search.js"></script>











<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.init({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    }, '.mermaid');
  }, window.mermaid);
}
</script>


  

  
<script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>

<script>
var options = {
  bottom: '64px',
  right: 'unset',
  left: '32px',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#ededed',
  buttonColorLight: '#4a4a4a',
  saveInCookies: true,
  label: '◒',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script>

<script>
  var disqus_config = function() {
    this.page.url = "http://merikanto.org/2018/Load-Balancer/";
    this.page.identifier = "2018/Load-Balancer/";
    this.page.title = "HAProxy & Load Balancing";
    };
  NexT.utils.loadComments('#disqus_thread', () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://Merikanto-Blog.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>


  <script async src="/js/cursor/love.min.js"></script>

</body>
</html>
