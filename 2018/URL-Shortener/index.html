<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Raleway:300,300italic,400,400italic,700,700italic|New+Rocker:300,300italic,400,400italic,700,700italic|Fira+Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  
  <link rel="stylesheet" href="/lib/animate-css/animate.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"merikanto.org","root":"/","scheme":"Muse","version":"8.0.0-rc.5","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":true,"color":"#6bb0e8","save":"manual"},"fancybox":true,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"buttons","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"path":"search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":3,"unescape":false,"preload":false}};
  </script>

  <meta name="description" content="Design a URL shortener, like bit.ly.  Step 1 is to scope the project. System design questions like this are usually intentionally left open-ended, so you have to ask some questions and make some decis">
<meta property="og:type" content="article">
<meta property="og:title" content="Design a URL Shortener">
<meta property="og:url" content="http://merikanto.org/2018/URL-Shortener/index.html">
<meta property="og:site_name" content="Merikanto">
<meta property="og:description" content="Design a URL shortener, like bit.ly.  Step 1 is to scope the project. System design questions like this are usually intentionally left open-ended, so you have to ask some questions and make some decis">
<meta property="og:locale" content="de_DE">
<meta property="article:published_time" content="2018-04-05T00:00:00.000Z">
<meta property="article:modified_time" content="2018-04-05T00:00:00.000Z">
<meta property="article:author" content="Merikanto">
<meta property="article:tag" content="System Design">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://merikanto.org/2018/URL-Shortener/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'de'
  };
</script>

  <title>Design a URL Shortener | Merikanto</title>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

<style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}</style></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <main class="main">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader">
        <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Navigationsleiste an/ausschalten">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Merikanto</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-blog">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Blog</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Kategorien</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Zeitleiste</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>Info</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Suchen
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Suchbegriff..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Übersicht
        </li>
        <li class="sidebar-nav-overview">
          Info
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
          <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Features"><span class="nav-number">1.</span> <span class="nav-text">Features</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Design-Goals"><span class="nav-number">2.</span> <span class="nav-text">Design Goals</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Data-Model"><span class="nav-number">3.</span> <span class="nav-text">Data Model</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Views-Pages-Endpoints"><span class="nav-number">4.</span> <span class="nav-text">Views&#x2F;Pages&#x2F;Endpoints</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Slug-generation"><span class="nav-number">5.</span> <span class="nav-text">Slug generation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#What-characters-can-we-allow-in-our-randomly-generated-slugs"><span class="nav-number">6.</span> <span class="nav-text">What characters can we allow in our randomly-generated slugs?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#How-many-distinct-slugs-do-we-need"><span class="nav-number">7.</span> <span class="nav-text">How many distinct slugs do we need?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#How-short-can-we-make-our-slugs-while-still-getting-enough-distinct-possibilities"><span class="nav-number">8.</span> <span class="nav-text">How short can we make our slugs while still getting enough distinct possibilities?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Using-base-conversion-to-generate-slugs"><span class="nav-number">9.</span> <span class="nav-text">Using base conversion to generate slugs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Bonus"><span class="nav-number">10.</span> <span class="nav-text">Bonus</span></a></li></ol></div>
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Merikanto"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Merikanto</p>
  <div class="site-description" itemprop="description">不見世間過</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">125</span>
          <span class="site-state-item-name">Artikel</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">Kategorien</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">Tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/Merikanto" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Merikanto" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:ks.merikanto@gmail.com" title="E-Mail → mailto:ks.merikanto@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
  </div>


  <div class="links-of-blogroll animated">
    <div class="links-of-blogroll-title">
      　　
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://www.sigure.jp/" title="http:&#x2F;&#x2F;www.sigure.jp&#x2F;" rel="noopener" target="_blank">　凛として時雨　</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://tools.kali.org/tools-listing" title="https:&#x2F;&#x2F;tools.kali.org&#x2F;tools-listing" rel="noopener" target="_blank">All Kali Tools</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.shodan.io/" title="https:&#x2F;&#x2F;www.shodan.io&#x2F;" rel="noopener" target="_blank">Shodan</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://0pointer.net/blog/archives.html" title="https:&#x2F;&#x2F;0pointer.net&#x2F;blog&#x2F;archives.html" rel="noopener" target="_blank">Pid Eins</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.allthingsdistributed.com/" title="https:&#x2F;&#x2F;www.allthingsdistributed.com&#x2F;" rel="noopener" target="_blank">All Things Distributed</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.contrapositivediary.com/?p=1396" title="https:&#x2F;&#x2F;www.contrapositivediary.com&#x2F;?p&#x3D;1396" rel="noopener" target="_blank">Jeff Duntemann</a>
        </li>
    </ul>
  </div>

      </section>
        <div class="back-to-top animated">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </header>

      
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/Merikanto" class="github-corner" title="Check out my GitHub" aria-label="Check out my GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div id="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


      <div class="main-inner">
        

        <div class="content post posts-expand">
          

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="de">
    <link itemprop="mainEntityOfPage" href="http://merikanto.org/2018/URL-Shortener/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Merikanto">
      <meta itemprop="description" content="不見世間過">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Merikanto">
    </span>

    
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Design a URL Shortener
        </h1>

        <div class="post-meta">

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Veröffentlicht am</span>

              <time title="Erstellt: 2018-04-05 00:00:00" itemprop="dateCreated datePublished" datetime="2018-04-05T00:00:00Z">2018-04-05</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">in</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Notes/" itemprop="url" rel="index"><span itemprop="name">Notes</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="Aufrufe" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="far fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Aufrufe: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="Symbole im Artikel gezählt">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbole im Artikel gezählt: </span>
              <span>22k Wörter</span>
            </span>
            <span class="post-meta-item" title="Lesezeit">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Lesezeit &asymp;</span>
              <span>28 min</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>Design a URL shortener, like <code>bit.ly.</code> </p>
<p><strong>Step 1 is to scope the project</strong>. System design questions like this are usually intentionally left open-ended, so you have to ask some questions and make some decisions about exactly what you’re building to get on the same page as your interviewer.</p>
<span id="more"></span> 

<p>So, what are we building? What features might we need?</p>
<br>

<h2 id="Features"><a href="#Features" class="headerlink" title="Features"></a>Features</h2><p>Is this a full web app, with a web interface? No, let’s just build an API to start.</p>
<p><strong>Since it’s an API, do we need authentication or user accounts or developer keys?</strong> No, let’s just make it open to start.</p>
<p><strong>Can people modify or delete links?</strong> Let’s leave that out for now.</p>
<p><strong>If people can’t delete links…do they persist forever? Or do we automatically remove old ones?</strong> First, it’s worth considering what policies we could use for removing old ones:</p>
<ul>
<li>(1) We could remove links that were created some length of time ago…like 6 months.</li>
</ul>
<ul>
<li>(2) We could remove links that haven’t been visited in some length of time…like 6 months.</li>
</ul>
<p>(2) seems less frustrating than (1). </p>
<br>

<p>Are there cases where (2) could still frustrate users? If a link is on the public web, it’s likely to get hit somewhat regularly, at least by spiders. But what if it’s on the private web (e.g. an internal “resources” page on a private university intranet)? Or…what if someone printed a bunch of pamphlets that had the URL on it, didn’t give out any pamphlets for a few months, then started giving them out again? That seems like a pretty reasonable thing that might happen (putting a URL on a printed piece of paper is a great reason to use a link shortener!) and having the link suddenly stop working would be quite frustrating for the user. Worse, what if a book already had the shortlink printed in a million copies? So let’s let links exist forever.</p>
<p><strong>Should we let people choose their shortlink, or just always auto-generate it?</strong> For example, say they want ca.ke/parkers-resume. Let’s definitely support that.</p>
<p><strong>Do we need analytics, so people can see how many people are clicking on a link, etc?</strong> Hmmm, good idea. But let’s leave it out to start.</p>
<p>It’s okay if your list of features was different from ours. Let’s proceed with these requirements so we’re working on the same problem.</p>
<p><strong>Next step: Design goals.</strong> If we’re designing something, we should know what we’re optimizing for! What are we optimizing for?</p>
<br>

<h2 id="Design-Goals"><a href="#Design-Goals" class="headerlink" title="Design Goals"></a>Design Goals</h2><p>Here’s what we came up with:</p>
<ul>
<li><p>We should be able to store a lot of links, since we’re not automatically expiring them.</p>
</li>
<li><p>Our shortlinks should be as short as possible. The whole point of a link shortener is to make short links! Having shorter links than our competition could be a business advantage.</p>
</li>
<li><p>Following a shortlink should be fast.</p>
</li>
<li><p>The shortlink follower should be resilient to load spikes. One of our links might be the top story on Reddit, for example.</p>
</li>
</ul>
<blockquote>
<p>It’s worth taking a moment to really think about the order of our goals. Sometimes design goals are at odds with each other (to do a better job of one, we need to do a worse job of another). So it’s helpful to know which goals are more important than others.</p>
</blockquote>
<p>It’s okay if your list wasn’t just like ours. But to get on the same page, let’s move forward with these design goals.</p>
<p><strong>Next step: building the data model</strong>. Think about the database schema or the models we’ll want. What things do we need to store, and how should they relate to each other? This is the part where we answer questions like “is this a many-to-many or a one-to-many?” or “should these be in the same table or different tables?”</p>
<br>

<h2 id="Data-Model"><a href="#Data-Model" class="headerlink" title="Data Model"></a>Data Model</h2><p>It’s worthwhile to be careful about how we name things. This’ll help us communicate clearly with our interviewer, and it’ll show that we care about using descriptive and consistent names! Many interviewers look for this.</p>
<p>Let’s call our main entity a Link. A Link is a mapping between a short_link on our site, and a long_link, where we redirect people when they visit the short_link.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">  <span class="string">Link</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">short_link</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">long_link</span></span><br></pre></td></tr></table></figure>
<p>The short_link could be one we’ve randomly generated, or one a user chose.</p>
<p>Of course, we don’t need to store the full ShortLink URL (e.g. ca.ke/mysite), we just need to store the “slug”—the part at the end (e.g. “mysite”).</p>
<p>So let’s rename the short_link field to “slug.”</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">  <span class="string">Link</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">slug</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">long_link</span></span><br></pre></td></tr></table></figure>

<p>Now the name long_link doesn’t make as much sense without short_link. So let’s change it to destination.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">  <span class="string">Link</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">slug</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">destination</span></span><br></pre></td></tr></table></figure>

<p>And let’s call this whole model/table ShortLink, to be a bit more specific.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">  <span class="string">ShortLink</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">slug</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">destination</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Investing time in carefully naming things from the beginning is always impressive in an interview. A big part of code readability is how well things are named!</p>
</blockquote>
<br>

<p><strong>Next: sketching the code</strong>. Don’t get hung up on the details here—pseudocode is fine.</p>
<p>Think of this part as sprinting to a naive first draft design, so you and your interviewer can get on the same page and have a starting point for optimizing. There may be things that come up as you go that are clearly “tricky issues” that need to be thought through. Feel free to skip these as you go—just jot down a note to come back to them later.</p>
<p>Our main goal here is to come up with a skeleton to start building things out from. Think about what endpoints/views we’ll need, and what each one will have to do.</p>
<br>

<h2 id="Views-Pages-Endpoints"><a href="#Views-Pages-Endpoints" class="headerlink" title="Views/Pages/Endpoints"></a>Views/Pages/Endpoints</h2><p><strong>First, let’s make a way to create a ShortLink.</strong></p>
<p>Since we’re making an API, let’s make it <a target="_blank" rel="noopener" href="https://www.restapitutorial.com/lessons/restquicktips.html">REST-style</a>. In normal REST style, our endpoint for creating a ShortLink should be named after the entity we’re creating. Versioning apis is also a reasonable thing to do. So let’s put our creation endpoint at <code>ca.ke/api/v1/shortlink</code>.</p>
<p>To create a new ShortLink, we’ll send a POST request there. Our POST request will include one required argument: the destination where our ShortLink will point. It’ll also optionally take a slug argument. If no slug is provided, we’ll generate one. The response will contain the newly-created ShortLink, including its slug and destination.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">$</span> <span class="string">curl</span> <span class="string">--data</span> <span class="string">&#x27;&#123;&quot;destination&quot;: &quot;interviewcake.com&quot;&#125;&#x27;</span> <span class="string">https://ca.ke/api/v1/shortlink</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;slug&quot;:</span> <span class="string">&quot;ae8uFt&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;destination&quot;:</span> <span class="string">&quot;interviewcake.com&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In usual REST style, we should allow GET, PUT, PATCH, and DELETE requests as well to read, modify, and delete links. But since that’s not a requirement yet, we’ll just reject non-POST requests with an error 501 (“not implemented”) for now.</p>
<br>

<p>So our endpoint might look something like this (pseudocode):</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shortlink</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="keyword">if</span> request[<span class="string">&#x27;method&#x27;</span>] <span class="keyword">is</span> <span class="keyword">not</span> <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> Response(<span class="number">501</span>)  <span class="comment"># HTTP 501 NOT IMPLEMENTED</span></span><br><span class="line"></span><br><span class="line">    destination = request[<span class="string">&#x27;data&#x27;</span>][<span class="string">&#x27;destination&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;slug&#x27;</span> <span class="keyword">in</span> request[<span class="string">&#x27;data&#x27;</span>]:</span><br><span class="line">        <span class="comment"># If they included a slug, use that</span></span><br><span class="line">        slug = request[<span class="string">&#x27;data&#x27;</span>][<span class="string">&#x27;slug&#x27;</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># Else, make them one</span></span><br><span class="line">        slug = generate_random_slug()</span><br><span class="line"></span><br><span class="line">    DB.insert(&#123;<span class="string">&#x27;slug&#x27;</span>: slug, <span class="string">&#x27;destination&#x27;</span>: destination&#125;)</span><br><span class="line"></span><br><span class="line">    response_body = &#123; <span class="string">&#x27;slug&#x27;</span>: slug &#125;</span><br><span class="line">    <span class="keyword">return</span> Response(<span class="number">200</span>, json.dumps(response_body))  <span class="comment"># HTTP 200 OK</span></span><br></pre></td></tr></table></figure>

<p>Of course, we haven’t defined exactly how generate_random_slug() works. Considering it a bit, it quickly becomes clear this is a pretty tangled issue. We’ll have to figure out:</p>
<ul>
<li><p>What characters can we use in randomly generated slugs? More possible characters means more possible random slugs without making our shortlinks longer. But what characters are allowed in URLs?</p>
</li>
<li><p>How do we ensure a randomly generated slug hasn’t already been used? Or if there is such a collision, how do we handle it?</p>
</li>
</ul>
<p>So let’s jot down these questions, put them aside, and come back to them after we’re done sketching our general app structure.</p>
<br>

<p><strong>Second, let’s make a way to follow a ShortLink</strong>. That’s the whole point, after all!</p>
<p>Our shortened URLs should be as short as possible. So as mentioned before, we’ll give them this format: <code>ca.ke/$slug</code>.</p>
<p>Where <code>$slug</code> is the slug (either auto-generated by us or specified by the user). We could make it clearer that this is a redirect endpoint, by using a format like <code>ca.ke/r/$slug</code>, for example. But that adds 2 precious characters of length to our shortlink URLs!</p>
<blockquote>
<p>One potential challenge here: if/when we build a web app for our service, we’ll need some way of differentiating our own pages from shortlinks. For example, if we want an about page at ca.ke/about, our back-end will need to know “about” isn’t just a shortlink slug. In fact, we might want to “reserve” or “block” shortlinks for pages we think we might need, so users don’t grab URLs we might want for our own site. Alternately we could just say our pages have paths that’re always prefixed with something, like /w/. For example, ca.ke/w/about.</p>
</blockquote>
<p>The code for the redirection endpoint is pretty simple:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">redirect</span>(<span class="params">request</span>):</span></span><br><span class="line">    destination = DB.get(&#123;<span class="string">&#x27;slug&#x27;</span>: request[<span class="string">&#x27;path&#x27;</span>]&#125;)[<span class="string">&#x27;destination&#x27;</span>]</span><br><span class="line">    <span class="keyword">return</span> Response(<span class="number">302</span>, destination)</span><br></pre></td></tr></table></figure>

<p><strong>Next: slug generation</strong>. Let’s return to those questions we came up with about slugs. How long should they be, what characters should we allow, and how should we handle random slug collisions?</p>
<br>

<h2 id="Slug-generation"><a href="#Slug-generation" class="headerlink" title="Slug generation"></a>Slug generation</h2><blockquote>
<p>A note about methodology: Our default process for answering questions like this is often “make a reasonable guess, brainstorm potential issues, and revise.” That’s fine, but sometimes it feels more organized and impressive to do something more like “brainstorm design goals, then design around those goals.” So we’ll do that.</p>
</blockquote>
<p>Let’s look back up at the design goals we came up with earlier. The first two are immediately relevant to this problem:</p>
<ul>
<li>We should be able to store a lot of links.</li>
<li>Our shortlinks should be as short as possible.</li>
</ul>
<br>

<p>Looking at a few examples, we can quickly notice that the more characters we allow in our shortlinks, the more different ShortLinks we can have without making our ShortLinks longer. Specifically, if we allow cc different characters, for nn-character-long slugs we have c<sup>n</sup>  distinct possibilities.</p>
<br>

<p>So if we’re trying to accommodate as many slugs as possible, we should allow as many characters as we can! So let’s do this:</p>
<ul>
<li><p>Figure out the max set of characters we can allow in our random shortlinks.</p>
</li>
<li><p>Figure out how many distinct shortlinks we want to accommodate.</p>
</li>
<li><p>Figure out how long our shortlinks must be to accommodate that many distinct possibilities.<br>Sketching a process like this before jumping in is hugely impressive. It shows organized, methodical thinking. Whenever you’re not sure how to proceed, take a step back and try to write out a process for getting to the bottom of things. It’s fine if you end up straying from your plan—it’ll still help you organize your thinking.</p>
</li>
</ul>
<br>

<h2 id="What-characters-can-we-allow-in-our-randomly-generated-slugs"><a href="#What-characters-can-we-allow-in-our-randomly-generated-slugs" class="headerlink" title="What characters can we allow in our randomly-generated slugs?"></a>What characters can we allow in our randomly-generated slugs?</h2><p>What are the constraints on cc? Let’s think about it:</p>
<ul>
<li><p>We should only use characters that are actually allowed in URLs.</p>
</li>
<li><p>We should probably only pick characters that are relatively easy to type on a keyboard. Remember the use case we talked about where people are typing in a ShortLink that they’re reading off a piece of paper?</p>
</li>
</ul>
<p>So, what characters are allowed in URLs? It’s okay to not know the answer off the top of your head. But you should be able to tell your interviewer that you know how to figure it out! Googling or searching on Stack Overflow is a fine answer.</p>
<br>

<p>It turns out the answer is “only alphanumerics, the special characters <code>$-_.+!*&#39;(),</code>, and reserved characters used for their reserved purposes may be used unencoded within a URL” (RFC 1738). “Reserved characters” with “reserved purposes” are characters like ‘?’, which marks the beginning of a query string, and ‘#’, which marks the beginning of a fragment/anchor. We definitely shouldn’t use any of those. If we allowed ‘?’ in the beginning of our slug, the characters after it would be interpreted as part of the query string and not part of the slug!</p>
<p>So just alphanumerics and the “special characters” <code>$-_.+!*&#39;(),</code>. Are accented alphabetical characters allowed? No, according to RFC 3986.</p>
<p>What about uppercase and lowercase? Domains aren’t case-sensitive (so google.com and Google.com will always go to the same place), but the path portion of a URL is case-sensitive. If I query parker.com/foo and parker.com/Foo, I’m requesting different documents (although, as a site owner, I may choose to return the same document in response to both requests). So yes, lowercase and capital versions of the same letter can be treated as different characters in our slugs.</p>
<p><br>Okay, so it seems like the set of allowed characters is A-Z, a-z, 0-9, and <code>$-_.+!*&#39;(),</code>. The apostrophe character seems a little iffy, since sometimes URLs are surrounded by single quotes in HTML documents. So let’s pull that one.</p>
<p>In fact, in keeping with point (2) above about ease of typing, let’s pull all the “special characters” from our list. It seems like a small loss on character count (8 characters) in exchange for a big win on readability and typeability. If we find ourselves wanting those extra characters, we can add add ‘em back in.</p>
<p>Ah, but what if a user is specifying her own slug? She might want to use underscores, or dashes, or parentheses…so let’s say for user-specified slugs, we allow <code>$-_.+!*&#39;(),</code> (still no apostrophe).</p>
<blockquote>
<p>While we’re on the topic of making URLs easy to type, we might want to consider constraining our character set to clear up common ambiguities. For example, not allowing both uppercase letter O and number 0. Or lowercase letter l and number 1. Font choice can help reduce these ambiguities, but we don’t have any control over the fonts people use to display our shortlinks. This is a worthwhile consideration, but at the moment it’s adding complexity to a question we’re still trying to figure out. So let’s just mention it and say, “This is something we want to keep an eye on for later, but let’s put it aside for now.” Your interviewer understands that you can’t accommodate everything in your initial design, but she’ll appreciate you showing an ability to anticipate what problems may come up in the user experience.</p>
</blockquote>
<p>Okay, so with a-z, A-Z, and 0-9, we have 26 + 26 + 10 = 62 possible characters in our randomly-generated slugs. And for user-generated slugs, we have another 10 characters <code>$-_.+!*&#39;(),</code>, for 72 total.</p>
<br>

<h2 id="How-many-distinct-slugs-do-we-need"><a href="#How-many-distinct-slugs-do-we-need" class="headerlink" title="How many distinct slugs do we need?"></a>How many distinct slugs do we need?</h2><p>About how many slugs do we need to be able to accommodate? This is a good question to ask your interviewer. She may want you to make a reasonable choice yourself. There’s no one right answer; the important thing is to show some organized thinking.</p>
<p>Here’s one way to come up with a ballpark estimate: about how many new slugs might we create on a busy day? Maybe 100,000 per minute? Hard to imagine more than that. That’s 100,000 * 60 * 24 ≈ 145100,000∗60∗24≈145 million new links a day. 52.5 billion a year. What’s a number of years that feels like “almost forever”? I’d say 100. So that’s 5.2 trillion slugs. That seems sufficiently large. It’s pretty dependent on the accuracy of our estimate of 100,000 per minute. But it seems to be a pretty reasonable ceiling, and a purposefully high one. If we can accommodate that many slugs, we expect we’ll be able to keep handing out random slugs effectively indefinitely.</p>
<br>

<h2 id="How-short-can-we-make-our-slugs-while-still-getting-enough-distinct-possibilities"><a href="#How-short-can-we-make-our-slugs-while-still-getting-enough-distinct-possibilities" class="headerlink" title="How short can we make our slugs while still getting enough distinct possibilities?"></a>How short can we make our slugs while still getting enough distinct possibilities?</h2><p>Let’s return to the formula we came up with before: with a c-character-long alphabet and slugs of length nn, we get c^n possible slugs. We want ~5 trillion possible slugs. And we decided on a 62-character alphabet. So 62^n ≈ 5 trillion. We just have to solve for nn.</p>
<p>We might know that we need to take a logarithm to solve for nn. But even if we know that, this is a tricky thing to eyeball. If we’re in front of a computer or phone, we can just plug it in to wolfram alpha. Turns out the answer is ≈7.09≈7.09. So 7 characters gets us most of the way to our target number of distinct possibilities.</p>
<p>It’s worth checking how many characters we could save by allowing <code>$-_.+!*&#39;()</code>, as well. So 72^n 5.2 trillion. We get n≈6.8. Including the special characters would save us something like .3.3 characters on our slug length.</p>
<br>

<p>Is it worth it? Of course, there’s no such thing as a fraction of a character. If we really had to accommodate at least 5.2 trillion random slugs, we’d have to round up, which would mean 7.09 would round up to 8-character slugs for our 62-character alphabet (not including special characters) and 6.8 would round up to 7-character slugs for our 72-character alphabet (including special characters).</p>
<p>But we don’t really have to accommodate 5.2 trillion or more slugs. 5.2 trillion was just a ballpark estimate—and it was intended to be a high ceiling on how many slugs we expect to get. So let’s stick with our first instinct to remove those special characters for readability purposes, and let’s choose 7 characters for our slugs.</p>
<blockquote>
<p>At a glance, looks like bit.ly agrees with our choices! They seem to use the same alphabet as us (A-Z, a-z, and 0-9) and use 7 characters for each randomly-generated slug.</p>
<p>For some added potential brevity, and some added possible random slugs, we could also allow for random slugs with fewer than 7 characters. How many additional random slugs would that get us?</p>
<p>Since this doesn’t win us much, let’s skip it for now and only use exactly-7-character random slugs.</p>
<p>One interesting lesson here: going from 6 characters to 7 characters gave us a two orders of magnitude leap in our number of possible slugs. Going from 7 characters to 8 will give us another two orders of magnitude. So if and when we do start running out of 7-character random slugs, allowing just 1 more character will dramatically push back the point where we run out of random slugs.</p>
</blockquote>
<br>

<p>Okay, we know the characters we’ll use for slugs. And we know how many characters we’ll use. <strong>Next: how do we generate a random slug?</strong></p>
<p>We could just make a random choice for each character:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_random_slug</span>():</span></span><br><span class="line">    alphabet = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789&quot;</span></span><br><span class="line">    num_chars = <span class="number">7</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join([random.choice(alphabet) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(num_chars)])</span><br></pre></td></tr></table></figure>

<p><strong>But how do we ensure slugs are unique?</strong> Two general strategies:</p>
<ul>
<li><p>“Re-roll” when we hit an already-used slug</p>
</li>
<li><p>Adjust our slug generation strategy to only ever give us un-claimed slugs.</p>
</li>
</ul>
<p>If we’re serious about our first 2 design goals (short slugs, and accommodating many different slugs), option (2) is clearly better than option (1). Why? As we have more and more slugs in our database, we’ll get more and more collisions. For example, when we’re 3/4 of the way through our set of possible 7-character slugs, we’d expect to have to make four “rolls” before arriving at a slug that isn’t taken already. And it’ll just keep going up from there.</p>
<p>So let’s try to come up with a strategy for option (2). How could we do it?</p>
<p>The answer is base conversion.</p>
<br>

<h2 id="Using-base-conversion-to-generate-slugs"><a href="#Using-base-conversion-to-generate-slugs" class="headerlink" title="Using base conversion to generate slugs"></a>Using base conversion to generate slugs</h2><p>We usually use base-10 numbers, which allow 10 possible numerals: 0, 1, 2, 3, 4, 5, 6, 7, 8, and 9.</p>
<p>Binary is base-2 and has 2 possible numerals: 0 and 1.</p>
<p>Our random slug alphabet has 62 possible numerals (A-Z, a-z, and 0-9). So we can think of each of our possible “random” slugs as a unique number, expressed in base-62.</p>
<br>

<p>So let’s keep track of a global current_random_slug_id. When a request for a new random slug comes in, we simply convert that number to base-62 (using our custom numeral set) and return it. Oh, and we increment the current_random_slug_id, in preparation for the next request for a random slug.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_random_slug</span>():</span></span><br><span class="line">    <span class="keyword">global</span> current_random_slug_id</span><br><span class="line">    slug = base_conversion(current_random_slug_id, base_62_alphabet)</span><br><span class="line">    current_random_slug_id += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> slug</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Where should we store our current_random_slug_id? We can keep it in memory on our web server, perhaps with a regular writethrough to the database, to make it persistent even if the web server crashes. But what if we have multiple front-end web servers?</p>
</blockquote>
<p>How do we do the base conversion? This is easiest to show by example.</p>
<p>Take the number 125 in base 10. So to convert 125 to base-62, the answer is 21. Another example, 7,912 is the three-digit number <code>2 3 38</code>.</p>
<br>

<p><strong>One potential issue</strong>: the current_random_slug_id could be shorter than 7 digits in base-62. We could pad the generate slug with zeros to force it to be exactly 7 characters. Or we could simply accept shorter random slugs—we’d just need to make sure our function that converts slugs back to numbers doesn’t choke when the slug is fewer than 7 characters.</p>
<p><strong>Another issue</strong> is that the current_random_slug_id could give us something that a user has already claimed as a user-generated slug. We’ll need to check for that, and if it happens we’ll just increment the current_random_slug_id and try again (and again, potentially, until we hit a “random” slug that hasn’t been used yet).</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_random_slug</span>():</span></span><br><span class="line">    <span class="keyword">global</span> current_random_slug_id</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        slug = base_conversion(current_random_slug_id, base_62_alphabet)</span><br><span class="line">        current_random_slug_id += <span class="number">1</span></span><br><span class="line">        <span class="comment"># Make sure the slug isn&#x27;t already used</span></span><br><span class="line">        existing = DB.get(&#123;<span class="string">&#x27;slug&#x27;</span>: slug&#125;)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> existing:</span><br><span class="line">            <span class="keyword">return</span> slug</span><br></pre></td></tr></table></figure>

<p>Okay, this’ll work! What’s next? </p>
<br>
## Database Choice


<p>Let’s look back at our design goals!</p>
<ul>
<li><p>We should be able to store a lot of links.</p>
</li>
<li><p>Our shortlinks should be as short as possible.</p>
</li>
<li><p>Following a shortlink should be fast.</p>
</li>
<li><p>The shortlink follower should be resilient to load spikes.</p>
</li>
</ul>
<p>We’re all set on (1) and (2)! Let’s start tackling (3) and (4). How do we scale our link follower to be fast and resilient to load spikes?</p>
<blockquote>
<p>Beware of premature optimization! That always looks bad. Don’t just jump around random ideas for optimizations. Instead, focus on asking yourself which thing is likely to bottleneck first and optimizing around that.</p>
</blockquote>
<br>

<p>The database read to get the destination for the given slug is certainly going to be our first bottleneck. In general, database operations usually bottleneck before business logic.</p>
<p>To figure out how to get these reads nice and fast, we should get specific about how we’re storing our shortlinks. To start, what kind of database should we use?</p>
<p>Database choice is a very broad issue. And it’s a contentious one. There are lots of different opinions about how to approach this. Here’s how we’ll do it:</p>
<br>

<p>Broadly (this is definitely a simplification), there are two main types of databases these days:</p>
<ul>
<li><p>Relational databases (RDBMs) like MySQL and Postgres.</p>
</li>
<li><p>“NoSQL”-style databases like BigTable and Cassandra.</p>
</li>
</ul>
<p>In general (again, this is a simplification), relational databases are great for systems where you expect to make lots of complex queries involving joins and such—in other words, they’re good if you’re planning to look at the relationships between things a lot. NoSQL databases don’t handle these things quite as well, but in exchange they’re faster for writes and simple key-value reads.</p>
<p>Looking at our app, it seems like relational queries aren’t likely to be a big part of our app’s functionality, even if we added a few of the obvious next features we might want. So let’s go with <strong>NoSQL</strong> for this.</p>
<br>

<p>Which NoSQL database do we use? Lots of options, each with their own pros and cons. Let’s keep our discussion and pseudocode generic for now.</p>
<blockquote>
<p>We might consider adding an abstraction layer between our application and the database, so that we can change over to a new one if our needs change or if some new hotness comes out.</p>
</blockquote>
<p>Okay, so we have our data in a NoSQL-type database. How do we un-bottleneck database reads?</p>
<p>The first step is to make sure we’re indexing the right way. In a NoSQL context, that means carefully designing our keys. In this case, the obvious choice is right: making the key for each row in the ShortLink table be the slug.</p>
<blockquote>
<p>If we used a SQL-type database like MySQL or Postgres, we usually default to having our key field be a standard auto-incrementing integer called “id” or “index.” But in this case, because we know that slugs will be unique, there’s no need for an integer id—the slug is enough of a unique identifier.</p>
<p>BUT here’s where it gets clever: what if we represented the slug as an auto-incrementing integer field? We’d just have to use our base conversion function to convert them to slugs! This would also give us tracking of our global current_random_slug_id for free—MySQL would keep track of the highest current id in the table when it auto increments. Careful though: user-generated slugs throw a pretty huge monkey wrench into things with this strategy! How can you maintain uniqueness across user-generated and randomly-generated slugs without breaking the auto-incrementing ids for randomly-generated slugs?</p>
</blockquote>
<br>

<p>How else can we <strong>speed up database reads</strong>?</p>
<p>We could put as much of the data in memory as possible, to avoid disc seeks.</p>
<p>This becomes especially important when we start getting a heavy load of requests to a single link, like if one of our links is on the front page of Reddit. If we have the redirect URL right there in memory, we can process those redirects quickly.</p>
<p>Depending on the database we use, it might already have an in-memory cache system. To get more links in memory, we may be able to configure our database to use more space for its cache.</p>
<p>If reads are still slow, we could research adding a caching layer, like memcached. Importantly, this might not save us time on reads, if the cache on the database is already pretty robust. It adds complexity—we now have two sources of truth, and we need to be careful to keep them in sync. For example, if we let users edit their links, we need to push those edits to both the database and the cache. It could also slow down reads if we have lots of cache misses.</p>
<p><strong>If we did add a caching layer</strong>, there are a few things we could talk about:</p>
<ul>
<li><p><strong>The eviction strategy</strong>. If the cache is full, what do we remove to make space? The most common answer is an LRU (“least recently used”) strategy.</p>
</li>
<li><p><strong>Sharding strategy</strong>. Sharding our cache lets us store more stuff in memory, because we can use more machines. But how do we decide which things go on which shard? The common answer is a “hash and mod strategy”—hash the key, mod the result by the number of shards, and you get a shard number to send your request to. But then how do you add or remove a shard without causing an unmanageable spike in cache misses?</p>
</li>
</ul>
<p>Of course, we could shard our underlying database instead of, or in addition to caching. If the database has a built-in in-memory cache, sharding the data would allow us to keep more of our data in working memory without an additional caching layer! Database sharding has some of the same challenges as cache sharding. Adding and removing shards can be painful, as can migrating the schema without site downtime. That said, some NoSQL databases have great sharding systems built right in, like <strong>Cassandra</strong>.</p>
<br>

<p>This should get our database reads nice and fast.</p>
<p>The next bottleneck might be processing the actual web requests. To remedy this, we should set up multiple web server workers. We can put them all behind a load balancer that distributes incoming requests across the workers. Having multiple web servers adds some complexity to our database (and caching layers) that we’ll need to consider. They’ll need to handle more simultaneous connections, for example. Most databases are pretty good at this by default.</p>
<p>Okay, now our redirects should go pretty quick, and should be resilient to load spikes. We have a solid system that fits all of our design goals!</p>
<ul>
<li><p>We can store a lot of links.</p>
</li>
<li><p>Our shortlinks are as short as possible.</p>
</li>
<li><p>Following a shortlink is fast.</p>
</li>
<li><p>The shortlink follower is resilient to load spikes.</p>
</li>
</ul>
<br>

<h2 id="Bonus"><a href="#Bonus" class="headerlink" title="Bonus"></a>Bonus</h2><p>As with all system design questions, there are a bunch more directions to go into with this one. A few ideas:</p>
<ul>
<li><p>At some point we’d probably want to consider splitting our link creation endpoint across multiple workers as well. This adds some complexity: how do they stay in sync about what the current_random_slug_id is?</p>
</li>
<li><p>Uptime and “single point of failure” (SPOF) are common concerns in system design. Are there any SPOFs in our current architecture? How can we ensure that an individual machine failure won’t bring down our whole system?</p>
</li>
<li><p>Analytics. What if we wanted to show users some analytics about the links they’ve created? What analytics could we show, and how would we store and display them?</p>
</li>
<li><p>Editing and deleting. How would we add edit and delete features?</p>
</li>
<li><p>Optimizing for implementation time. We built something optimized for scale. How would our system design be different if we were just trying to get an MVP off the ground as quickly as possible?</p>
</li>
</ul>
<br>

<br>



    </div>

    
    
    <div>
    
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>Beitragsautor:  </strong>Merikanto
  </li>
  <li class="post-copyright-link">
    <strong>Beitragslink: </strong>
    <a href="http://merikanto.org/2018/URL-Shortener/" title="Design a URL Shortener">http://merikanto.org/2018/URL-Shortener/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Urheberrechtshinweis:  </strong>Alle Artikel in diesem Blog sind unter <a target="_blank" rel="noopener" href="https://github.com/Merikanto">Merikanto</a> lizenziert, außer es wird anders angegeben.
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/System-Design/" rel="tag"><i class="fa fa-tag"></i> System Design</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2018/LC-Java-List/" rel="prev" title="LC Linked List (Java)">
      <i class="fa fa-chevron-left"></i> LC Linked List (Java)
    </a></div>
      <div class="post-nav-item">
    <a href="/2018/Assembly/" rel="next" title="Assembly - Structures & How">
      Assembly - Structures & How <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



        </div>
        
    
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2016 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>  
  </span>
  <a href="/tools"><span class="author" itemprop="copyrightHolder">Merikanto</span></a>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Alle Besucher">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Alle Aufrufe">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>


  




  
<script src="/js/local-search.js"></script>











<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.init({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    }, '.mermaid');
  }, window.mermaid);
}
</script>


  

  
<script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>

<script>
var options = {
  bottom: '64px',
  right: 'unset',
  left: '32px',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#ededed',
  buttonColorLight: '#4a4a4a',
  saveInCookies: true,
  label: '◒',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script>

<script>
  var disqus_config = function() {
    this.page.url = "http://merikanto.org/2018/URL-Shortener/";
    this.page.identifier = "2018/URL-Shortener/";
    this.page.title = "Design a URL Shortener";
    };
  NexT.utils.loadComments('#disqus_thread', () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://Merikanto-Blog.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>


  <script async src="/js/cursor/love.min.js"></script>

</body>
</html>
