<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Raleway:300,300italic,400,400italic,700,700italic|New+Rocker:300,300italic,400,400italic,700,700italic|Fira+Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  
  <link rel="stylesheet" href="/lib/animate-css/animate.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"merikanto.org","root":"/","scheme":"Muse","version":"8.0.0-rc.5","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":true,"color":"#6bb0e8","save":"manual"},"fancybox":true,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"buttons","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"path":"search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":3,"unescape":false,"preload":false}};
  </script>

  <meta name="description" content="Prometheus is a powerful, open-source monitoring system that collects metrics from your services and stores them in a time-series database. It offers a multi-dimensional data model, a flexible query l">
<meta property="og:type" content="article">
<meta property="og:title" content="Configure Prometheus on Ubuntu">
<meta property="og:url" content="http://merikanto.org/2019/Prometheus/index.html">
<meta property="og:site_name" content="Merikanto">
<meta property="og:description" content="Prometheus is a powerful, open-source monitoring system that collects metrics from your services and stores them in a time-series database. It offers a multi-dimensional data model, a flexible query l">
<meta property="og:locale" content="de_DE">
<meta property="og:image" content="http://merikanto.org/images/posts/190814-1.png">
<meta property="og:image" content="http://merikanto.org/images/posts/190814-2.png">
<meta property="og:image" content="http://merikanto.org/images/posts/190814-3.png">
<meta property="og:image" content="http://merikanto.org/images/posts/190814-4.png">
<meta property="og:image" content="http://merikanto.org/images/posts/190814-5.png">
<meta property="og:image" content="http://merikanto.org/images/posts/190814-6.png">
<meta property="og:image" content="http://merikanto.org/images/posts/190814-7.png">
<meta property="og:image" content="http://merikanto.org/images/posts/190814-8.png">
<meta property="article:published_time" content="2019-08-14T00:00:00.000Z">
<meta property="article:modified_time" content="2019-08-14T00:00:00.000Z">
<meta property="article:author" content="Merikanto">
<meta property="article:tag" content="DevOps">
<meta property="article:tag" content="Linux">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://merikanto.org/images/posts/190814-1.png">

<link rel="canonical" href="http://merikanto.org/2019/Prometheus/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'de'
  };
</script>

  <title>Configure Prometheus on Ubuntu | Merikanto</title>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

<style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}</style></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <main class="main">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader">
        <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Navigationsleiste an/ausschalten">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Merikanto</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-blog">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Blog</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Kategorien</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Zeitleiste</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>Info</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Suchen
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Suchbegriff..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Übersicht
        </li>
        <li class="sidebar-nav-overview">
          Info
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
          <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Create-Service-Users"><span class="nav-number">1.</span> <span class="nav-text">Create Service Users</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Downloading-Prometheus"><span class="nav-number">2.</span> <span class="nav-text">Downloading Prometheus</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Config-Prometheus"><span class="nav-number">3.</span> <span class="nav-text">Config Prometheus</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Running-Prometheus"><span class="nav-number">4.</span> <span class="nav-text">Running Prometheus</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Download-Node-Exporter"><span class="nav-number">5.</span> <span class="nav-text">Download Node Exporter</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Running-Node-Exporter"><span class="nav-number">6.</span> <span class="nav-text">Running Node Exporter</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Use-Prometheus-to-Scrape-Node-Exporter"><span class="nav-number">7.</span> <span class="nav-text">Use Prometheus to Scrape Node Exporter</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Secure-Prometheus"><span class="nav-number">8.</span> <span class="nav-text">Secure Prometheus</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Test-Prometheus"><span class="nav-number">9.</span> <span class="nav-text">Test Prometheus</span></a></li></ol></div>
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Merikanto"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Merikanto</p>
  <div class="site-description" itemprop="description">不見世間過</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">125</span>
          <span class="site-state-item-name">Artikel</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">Kategorien</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">Tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/Merikanto" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Merikanto" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:ks.merikanto@gmail.com" title="E-Mail → mailto:ks.merikanto@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
  </div>


  <div class="links-of-blogroll animated">
    <div class="links-of-blogroll-title">
      　　
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://www.sigure.jp/" title="http:&#x2F;&#x2F;www.sigure.jp&#x2F;" rel="noopener" target="_blank">　凛として時雨　</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://tools.kali.org/tools-listing" title="https:&#x2F;&#x2F;tools.kali.org&#x2F;tools-listing" rel="noopener" target="_blank">All Kali Tools</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.shodan.io/" title="https:&#x2F;&#x2F;www.shodan.io&#x2F;" rel="noopener" target="_blank">Shodan</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://0pointer.net/blog/archives.html" title="https:&#x2F;&#x2F;0pointer.net&#x2F;blog&#x2F;archives.html" rel="noopener" target="_blank">Pid Eins</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.allthingsdistributed.com/" title="https:&#x2F;&#x2F;www.allthingsdistributed.com&#x2F;" rel="noopener" target="_blank">All Things Distributed</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.contrapositivediary.com/?p=1396" title="https:&#x2F;&#x2F;www.contrapositivediary.com&#x2F;?p&#x3D;1396" rel="noopener" target="_blank">Jeff Duntemann</a>
        </li>
    </ul>
  </div>

      </section>
        <div class="back-to-top animated">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </header>

      
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/Merikanto" class="github-corner" title="Check out my GitHub" aria-label="Check out my GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div id="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


      <div class="main-inner">
        

        <div class="content post posts-expand">
          

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="de">
    <link itemprop="mainEntityOfPage" href="http://merikanto.org/2019/Prometheus/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Merikanto">
      <meta itemprop="description" content="不見世間過">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Merikanto">
    </span>

    
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Configure Prometheus on Ubuntu
        </h1>

        <div class="post-meta">

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Veröffentlicht am</span>

              <time title="Erstellt: 2019-08-14 00:00:00" itemprop="dateCreated datePublished" datetime="2019-08-14T00:00:00Z">2019-08-14</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">in</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/DevOps/" itemprop="url" rel="index"><span itemprop="name">DevOps</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="Aufrufe" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="far fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Aufrufe: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="Symbole im Artikel gezählt">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbole im Artikel gezählt: </span>
              <span>15k Wörter</span>
            </span>
            <span class="post-meta-item" title="Lesezeit">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Lesezeit &asymp;</span>
              <span>19 min</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>Prometheus is a powerful, open-source monitoring system that collects metrics from your services and stores them in a time-series database. It offers a multi-dimensional data model, a flexible query language, and diverse visualization possibilities through tools like Grafana.</p>
<p>By default, Prometheus only exports metrics about itself (e.g. the number of requests it’s received, its memory consumption, etc.). But, you can greatly expand Prometheus by installing exporters, optional programs that generate additional metrics.</p>
<span id="more"></span> 

<p>Exporters — both the official ones that the Prometheus team maintains as well as the community-contributed ones — provide information about everything from infrastructure, databases, and web servers to messaging systems, APIs, and more.</p>
<p>Some of the most popular choices include:</p>
<ul>
<li><p><code>node_exporter</code> - This produces metrics about infrastructure, including the current CPU, memory and disk usage, as well as I/O and network statistics, such as the number of bytes read from a disk or a server’s average load.</p>
</li>
<li><p><code>blackbox_exporter</code> - This generates metrics derived from probing protocols like HTTP and HTTPS to determine endpoint availability, response time, and more.</p>
</li>
<li><p><code>mysqld_exporter</code> - This gathers metrics related to a MySQL server, such as the number of executed queries, average query response time, and cluster replication status.</p>
</li>
<li><p><code>rabbitmq_exporter</code> - This outputs metrics about the RabbitMQ messaging system, including the number of messages published, the number of messages ready to be delivered, and the size of all the messages in the queue.</p>
</li>
<li><p><code>nginx-vts-exporter</code> - This provides metrics about an Nginx web server using the Nginx VTS module, including the number of open connections, the number of sent responses (grouped by response codes), and the total size of sent or received requests in bytes.</p>
</li>
</ul>
<p>You can find a more complete list of both official and community-contributed exporters on Prometheus’ website.</p>
<p>In this post, we will install, configure, and secure Prometheus and Node Exporter to generate metrics that will make it easier to monitor your server’s performance.</p>
<br>

<blockquote>
<p>Reference:</p>
<p><a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/how-to-install-prometheus-on-ubuntu-16-04">Configure Prometheus on Ubuntu</a></p>
<p><a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorial_series/how-to-query-prometheus">How To Query Prometheus</a></p>
</blockquote>
<br>

<hr>
<h2 id="Create-Service-Users"><a href="#Create-Service-Users" class="headerlink" title="Create Service Users"></a>Create Service Users</h2><p>For security purposes, we’ll begin by creating two new user accounts, prometheus and node_exporter. We’ll use these accounts throughout the post to isolate the ownership on Prometheus’ core files and directories.</p>
<p>Create these two users, and use the –no-create-home and –shell /bin/false options so that these users can’t log into the server.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo useradd --no-create-home --shell /bin/<span class="literal">false</span> prometheus</span><br><span class="line">sudo useradd --no-create-home --shell /bin/<span class="literal">false</span> node_exporter</span><br></pre></td></tr></table></figure>
<p>Before we download the Prometheus binaries, create the necessary directories for storing Prometheus’ files and data. Following standard Linux conventions, we’ll create a directory in /etc for Prometheus’ configuration files and a directory in /var/lib for its data.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir /etc/prometheus</span><br><span class="line">sudo mkdir /var/lib/prometheus</span><br></pre></td></tr></table></figure>
<p>Now, set the user and group ownership on the new directories to the prometheus user.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo chown prometheus:prometheus /etc/prometheus</span><br><span class="line">sudo chown prometheus:prometheus /var/lib/prometheus</span><br></pre></td></tr></table></figure>
<p>With our users and directories in place, we can now download Prometheus and then create the minimal configuration file to run Prometheus for the first time.</p>
<br>

<hr>
<h2 id="Downloading-Prometheus"><a href="#Downloading-Prometheus" class="headerlink" title="Downloading Prometheus"></a>Downloading Prometheus</h2><p>First, download and unpack the current stable version of Prometheus into your home directory. You can find the latest binaries along with their checksums on the Prometheus download page.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line"></span><br><span class="line">curl -LO https://github.com/prometheus/prometheus/releases \ </span><br><span class="line">/download/v2.0.0/prometheus-2.0.0.linux-amd64.tar.gz</span><br></pre></td></tr></table></figure>
<p>Next, use the sha256sum command to generate a checksum of the downloaded file:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">sha256sum</span> <span class="string">prometheus-2.0.0.linux-amd64.tar.gz</span></span><br></pre></td></tr></table></figure>
<p>Compare the output from this command with the checksum on the Prometheus download page to ensure that your file is both genuine and not corrupted.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e12917b25b32980daee0e9cf879d9ec197e2893924bd1574604eb0f550034d46  </span><br><span class="line">prometheus-2.0.0.linux-amd64.tar.gz</span><br></pre></td></tr></table></figure>
<p>If the checksums don’t match, remove the downloaded file and repeat the preceding steps to re-download the file.</p>
<p>Now, unpack the downloaded archive.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">tar</span> <span class="string">xvf</span> <span class="string">prometheus-2.0.0.linux-amd64.tar.gz</span></span><br></pre></td></tr></table></figure>
<p>This will create a directory called prometheus-2.0.0.linux-amd64 containing two binary files (prometheus and promtool), consoles and console_libraries directories containing the web interface files, a license, a notice, and several example files.</p>
<p>Copy the two binaries to the /usr/local/bin directory.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo cp prometheus-2.0.0.linux-amd64/prometheus /usr/<span class="built_in">local</span>/bin/</span><br><span class="line">sudo cp prometheus-2.0.0.linux-amd64/promtool /usr/<span class="built_in">local</span>/bin/</span><br></pre></td></tr></table></figure>
<p>Set the user and group ownership on the binaries to the prometheus user created in Step 1.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo chown prometheus:prometheus /usr/<span class="built_in">local</span>/bin/prometheus</span><br><span class="line">sudo chown prometheus:prometheus /usr/<span class="built_in">local</span>/bin/promtool</span><br></pre></td></tr></table></figure>
<p>Copy the consoles and console_libraries directories to /etc/prometheus.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo cp -r prometheus-2.0.0.linux-amd64/consoles /etc/prometheus</span><br><span class="line">sudo cp -r prometheus-2.0.0.linux-amd64/console_libraries /etc/prometheus</span><br></pre></td></tr></table></figure>
<p>Set the user and group ownership on the directories to the prometheus user. Using the -R flag will ensure that ownership is set on the files inside the directory as well.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo chown -R prometheus:prometheus /etc/prometheus/consoles</span><br><span class="line">sudo chown -R prometheus:prometheus /etc/prometheus/console_libraries</span><br></pre></td></tr></table></figure>
<p>Lastly, remove the leftover files from your home directory as they are no longer needed.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">rm</span> <span class="string">-rf</span> <span class="string">prometheus-2.0.0.linux-amd64.tar.gz</span> <span class="string">prometheus-2.0.0.linux-amd64</span></span><br></pre></td></tr></table></figure>
<p>Now that Prometheus is installed, we’ll create its configuration and service files in preparation of its first run.</p>
<br>

<hr>
<h2 id="Config-Prometheus"><a href="#Config-Prometheus" class="headerlink" title="Config Prometheus"></a>Config Prometheus</h2><p>In the /etc/prometheus directory, use vim or your favorite text editor to create a configuration file named prometheus.yml. For now, this file will contain just enough information to run Prometheus for the first time.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">sudo</span> <span class="string">vim</span> <span class="string">/etc/prometheus/prometheus.yml</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Warning: Prometheus’ configuration file uses the YAML format, which strictly forbids tabs and requires two spaces for indentation. Prometheus will fail to start if the configuration file is incorrectly formatted.</p>
</blockquote>
<p>In the global settings, define the default interval for scraping metrics. Note that Prometheus will apply these settings to every exporter unless an individual exporter’s own settings override the globals.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">global:</span></span><br><span class="line">  <span class="attr">scrape_interval:</span> <span class="string">15s</span></span><br></pre></td></tr></table></figure>

<p>This scrape_interval value tells Prometheus to collect metrics from its exporters every 15 seconds, which is long enough for most exporters.</p>
<p>Now, add Prometheus itself to the list of exporters to scrape from with the following scrape_configs directive:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">scrape_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;prometheus&#x27;</span></span><br><span class="line">    <span class="attr">scrape_interval:</span> <span class="string">5s</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;localhost:9090&#x27;</span>]</span><br></pre></td></tr></table></figure>
<p>Prometheus uses the job_name to label exporters in queries and on graphs, so be sure to pick something descriptive here.</p>
<p>And, as Prometheus exports important data about itself that you can use for monitoring performance and debugging, we’ve overridden the global scrape_interval directive from 15 seconds to 5 seconds for more frequent updates.</p>
<p>Lastly, Prometheus uses the static_configs and targets directives to determine where exporters are running. Since this particular exporter is running on the same server as Prometheus itself, we can use localhost instead of an IP address along with the default port, 9090.</p>
<p>Your configuration file should now look like this:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">global:</span></span><br><span class="line">  <span class="attr">scrape_interval:</span> <span class="string">15s</span></span><br><span class="line"></span><br><span class="line"><span class="attr">scrape_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;prometheus&#x27;</span></span><br><span class="line">    <span class="attr">scrape_interval:</span> <span class="string">5s</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;localhost:9090&#x27;</span>]</span><br></pre></td></tr></table></figure>
<p>Save the file and exit your text editor.</p>
<p>Now, set the user and group ownership on the configuration file to the prometheus user created in Step 1.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">sudo</span> <span class="string">chown</span> <span class="string">prometheus:prometheus</span> <span class="string">/etc/prometheus/prometheus.yml</span></span><br></pre></td></tr></table></figure>
<p>With the configuration complete, we’re ready to test Prometheus by running it for the first time.</p>
<br>

<hr>
<h2 id="Running-Prometheus"><a href="#Running-Prometheus" class="headerlink" title="Running Prometheus"></a>Running Prometheus</h2><p>Start up Prometheus as the prometheus user, providing the path to both the configuration file and the data directory.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo -u prometheus /usr/<span class="built_in">local</span>/bin/prometheus \</span><br><span class="line">    --config.file /etc/prometheus/prometheus.yml \</span><br><span class="line">    --storage.tsdb.path /var/lib/prometheus/ \</span><br><span class="line">    --web.console.templates=/etc/prometheus/consoles \</span><br><span class="line">    --web.console.libraries=/etc/prometheus/console_libraries</span><br></pre></td></tr></table></figure>
<p>The output contains information about Prometheus’ loading progress, configuration file, and related services. It also confirms that Prometheus is listening on port 9090.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Output</span></span><br><span class="line"></span><br><span class="line">level=info ts=2017-11-17T18:37:27.474530094Z <span class="built_in">caller</span>=main.go:215 msg=<span class="string">&quot;Starting Prometheus&quot;</span> version=<span class="string">&quot;(version=2.0.0, branch=HEAD, re</span></span><br><span class="line"><span class="string">vision=0a74f98628a0463dddc90528220c94de5032d1a0)&quot;</span></span><br><span class="line">level=info ts=2017-11-17T18:37:27.474758404Z <span class="built_in">caller</span>=main.go:216 build_context=<span class="string">&quot;(go=go1.9.2, user=root@615b82cb36b6, date=20171108-</span></span><br><span class="line"><span class="string">07:11:59)&quot;</span></span><br><span class="line">level=info ts=2017-11-17T18:37:27.474883982Z <span class="built_in">caller</span>=main.go:217 host_details=<span class="string">&quot;(Linux 4.4.0-98-generic #121-Ubuntu SMP Tue Oct 10 1</span></span><br><span class="line"><span class="string">4:24:03 UTC 2017 x86_64 prometheus-update (none))&quot;</span></span><br><span class="line">level=info ts=2017-11-17T18:37:27.483661837Z <span class="built_in">caller</span>=web.go:380 component=web msg=<span class="string">&quot;Start listening for connections&quot;</span> address=0.0.0.0</span><br><span class="line">:9090</span><br><span class="line">level=info ts=2017-11-17T18:37:27.489730138Z <span class="built_in">caller</span>=main.go:314 msg=<span class="string">&quot;Starting TSDB&quot;</span></span><br><span class="line">level=info ts=2017-11-17T18:37:27.516050288Z <span class="built_in">caller</span>=targetmanager.go:71 component=<span class="string">&quot;target manager&quot;</span> msg=<span class="string">&quot;Starting target manager...</span></span><br><span class="line"><span class="string">&quot;</span></span><br><span class="line">level=info ts=2017-11-17T18:37:27.537629169Z <span class="built_in">caller</span>=main.go:326 msg=<span class="string">&quot;TSDB started&quot;</span></span><br><span class="line">level=info ts=2017-11-17T18:37:27.537896721Z <span class="built_in">caller</span>=main.go:394 msg=<span class="string">&quot;Loading configuration file&quot;</span> filename=/etc/prometheus/promethe</span><br><span class="line">us.yml</span><br><span class="line">level=info ts=2017-11-17T18:37:27.53890004Z <span class="built_in">caller</span>=main.go:371 msg=<span class="string">&quot;Server is ready to receive requests.&quot;</span></span><br></pre></td></tr></table></figure>

<p>If you get an error message, double-check that you’ve used YAML syntax in your configuration file and then follow the on-screen instructions to resolve the problem.</p>
<p>Now, halt Prometheus by pressing CTRL+C, and then open a new systemd service file.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">sudo</span> <span class="string">vim</span> <span class="string">/etc/systemd/system/prometheus.service</span></span><br></pre></td></tr></table></figure>
<p>The service file tells systemd to run Prometheus as the prometheus user, with the configuration file located in the <code>/etc/prometheus/prometheus.yml</code> directory and to store its data in the <code>/var/lib/prometheus</code> directory. (The details of systemd service files are beyond the scope of this post, but you can learn more at Understanding Systemd Units and Unit Files.)</p>
<p>Copy the following content into the file:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Prometheus</span><br><span class="line">Wants=network-online.target</span><br><span class="line">After=network-online.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=prometheus</span><br><span class="line">Group=prometheus</span><br><span class="line">Type=simple</span><br><span class="line">ExecStart=/usr/<span class="built_in">local</span>/bin/prometheus \</span><br><span class="line">    --config.file /etc/prometheus/prometheus.yml \</span><br><span class="line">    --storage.tsdb.path /var/lib/prometheus/ \</span><br><span class="line">    --web.console.templates=/etc/prometheus/consoles \</span><br><span class="line">    --web.console.libraries=/etc/prometheus/console_libraries</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>
<p>Finally, save the file and close your text editor.</p>
<p>To use the newly created service, reload systemd.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">sudo</span> <span class="string">systemctl</span> <span class="string">daemon-reload</span></span><br></pre></td></tr></table></figure>
<p>You can now start Prometheus using the following command:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">sudo</span> <span class="string">systemctl</span> <span class="string">start</span> <span class="string">prometheus</span></span><br></pre></td></tr></table></figure>
<p>To make sure Prometheus is running, check the service’s status.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">sudo</span> <span class="string">systemctl</span> <span class="string">status</span> <span class="string">prometheus</span></span><br></pre></td></tr></table></figure>
<p>The output tells you Prometheus’ status, main process identifier (PID), memory use, and more.</p>
<p>If the service’s status isn’t active, follow the on-screen instructions and re-trace the preceding steps to resolve the problem before continue. Lastly, enable the service to start on boot.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">sudo</span> <span class="string">systemctl</span> <span class="string">enable</span> <span class="string">prometheus</span></span><br></pre></td></tr></table></figure>
<p>Now that Prometheus is up and running, we can install an additional exporter to generate metrics about our server’s resources.</p>
<br>

<hr>
<h2 id="Download-Node-Exporter"><a href="#Download-Node-Exporter" class="headerlink" title="Download Node Exporter"></a>Download Node Exporter</h2><p>To expand Prometheus beyond metrics about itself only, we’ll install an additional exporter called Node Exporter. Node Exporter provides detailed information about the system, including CPU, disk, and memory usage.</p>
<p>First, download the current stable version of Node Exporter into your home directory. You can find the latest binaries along with their checksums on Prometheus’ download page.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line"></span><br><span class="line">curl -LO https://github.com/prometheus/node_exporter/releases/download/v0.15.1/node_exporter-0.15.1.linux-amd64.tar.gz</span><br></pre></td></tr></table></figure>
<p>Use the sha256sum command to generate a checksum of the downloaded file:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">sha256sum</span> <span class="string">node_exporter-0.15.1.linux-amd64.tar.gz</span></span><br></pre></td></tr></table></figure>
<p>Verify the downloaded file’s integrity by comparing its checksum with the one on the download page.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">7ffb3773abb71dd2b2119c5f6a7a0dbca0cff34b24b2ced9e01d9897df61a127</span>  <span class="string">node_exporter-0.15.1.linux-amd64.tar.gz</span></span><br></pre></td></tr></table></figure>
<p>If the checksums don’t match, remove the downloaded file and repeat the preceding steps.</p>
<p>Now, unpack the downloaded archive.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">tar</span> <span class="string">xvf</span> <span class="string">node_exporter-0.15.1.linux-amd64.tar.gz</span></span><br></pre></td></tr></table></figure>
<p>This will create a directory called node_exporter-0.15.1.linux-amd64 containing a binary file named node_exporter, a license, and a notice.</p>
<p>Copy the binary to the /usr/local/bin directory and set the user and group ownership to the node_exporter user that you created in Step 1.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo cp node_exporter-0.15.1.linux-amd64/node_exporter /usr/<span class="built_in">local</span>/bin</span><br><span class="line">sudo chown node_exporter:node_exporter /usr/<span class="built_in">local</span>/bin/node_exporter</span><br></pre></td></tr></table></figure>
<p>Lastly, remove the leftover files from your home directory as they are no longer needed.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">rm</span> <span class="string">-rf</span> <span class="string">node_exporter-0.15.1.linux-amd64.tar.gz</span> <span class="string">node_exporter-0.15.1.linux-amd64</span></span><br></pre></td></tr></table></figure>
<p>Now that you’ve installed Node Exporter, let’s test it out by running it before creating a service file for it so that it starts on boot.</p>
<br>

<hr>
<h2 id="Running-Node-Exporter"><a href="#Running-Node-Exporter" class="headerlink" title="Running Node Exporter"></a>Running Node Exporter</h2><p>The steps for running Node Exporter are similar to those for running Prometheus itself. Start by creating the Systemd service file for Node Exporter.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">sudo</span> <span class="string">vim</span> <span class="string">/etc/systemd/system/node_exporter.service</span></span><br></pre></td></tr></table></figure>
<p>This service file tells your system to run Node Exporter as the node_exporter user with the default set of collectors enabled.</p>
<p>Copy the following content into the service file:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">Unit</span>]</span><br><span class="line"><span class="string">Description=Node</span> <span class="string">Exporter</span></span><br><span class="line"><span class="string">Wants=network-online.target</span></span><br><span class="line"><span class="string">After=network-online.target</span></span><br><span class="line"></span><br><span class="line">[<span class="string">Service</span>]</span><br><span class="line"><span class="string">User=node_exporter</span></span><br><span class="line"><span class="string">Group=node_exporter</span></span><br><span class="line"><span class="string">Type=simple</span></span><br><span class="line"><span class="string">ExecStart=/usr/local/bin/node_exporter</span></span><br><span class="line"></span><br><span class="line">[<span class="string">Install</span>]</span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br></pre></td></tr></table></figure>
<p>Collectors define which metrics Node Exporter will generate. You can see Node Exporter’s complete list of collectors — including which are enabled by default and which are deprecated — in the Node Exporter README file.</p>
<p>If you ever need to override the default list of collectors, you can use the –collectors.enabled flag, like:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">Node</span> <span class="string">Exporter</span> <span class="string">service</span> <span class="string">file</span> <span class="string">part</span> <span class="bullet">-</span> <span class="string">/etc/systemd/system/node_exporter.service</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="string">ExecStart=/usr/local/bin/node_exporter</span> <span class="string">--collectors.enabled</span> <span class="string">meminfo,loadavg,filesystem</span></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure>
<p>The preceding example would tell Node Exporter to generate metrics using only the meminfo, loadavg, and filesystem collectors. You can limit the collectors to however few or many you need, but note that there are no blank spaces before or after the commas.</p>
<p>Save the file and close your text editor.</p>
<p>Finally, reload systemd to use the newly created service.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">sudo</span> <span class="string">systemctl</span> <span class="string">daemon-reload</span></span><br></pre></td></tr></table></figure>
<p>You can now run Node Exporter using the following command:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">sudo</span> <span class="string">systemctl</span> <span class="string">start</span> <span class="string">node_exporter</span></span><br></pre></td></tr></table></figure>
<p>Verify that Node Exporter’s running correctly with the status command.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">sudo</span> <span class="string">systemctl</span> <span class="string">status</span> <span class="string">node_exporter</span></span><br></pre></td></tr></table></figure>
<p>Like before, this output tells you Node Exporter’s status, main process identifier (PID), memory usage, and more.</p>
<p>If the service’s status isn’t active, follow the on-screen messages and re-trace the preceding steps to resolve the problem before continuing. Lastly, enable Node Exporter to start on boot.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">sudo</span> <span class="string">systemctl</span> <span class="string">enable</span> <span class="string">node_exporter</span></span><br></pre></td></tr></table></figure>
<p>With Node Exporter fully configured and running as expected, we’ll tell Prometheus to start scraping the new metrics.</p>
<br>

<hr>
<h2 id="Use-Prometheus-to-Scrape-Node-Exporter"><a href="#Use-Prometheus-to-Scrape-Node-Exporter" class="headerlink" title="Use Prometheus to Scrape Node Exporter"></a>Use Prometheus to Scrape Node Exporter</h2><p>Because Prometheus only scrapes exporters which are defined in the scrape_configs portion of its configuration file, we’ll need to add an entry for Node Exporter, just like we did for Prometheus itself.</p>
<p>Open the configuration file.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">sudo</span> <span class="string">vim</span> <span class="string">/etc/prometheus/prometheus.yml</span></span><br></pre></td></tr></table></figure>
<p>At the end of the scrape_configs block, add a new entry called node_exporter.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">...</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;node_exporter&#x27;</span></span><br><span class="line">    <span class="attr">scrape_interval:</span> <span class="string">5s</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;localhost:9100&#x27;</span>]</span><br></pre></td></tr></table></figure>
<p>Because this exporter is also running on the same server as Prometheus itself, we can use localhost instead of an IP address again along with Node Exporter’s default port, 9100.</p>
<p>Your whole configuration file should look like this:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">global:</span></span><br><span class="line">  <span class="attr">scrape_interval:</span> <span class="string">15s</span></span><br><span class="line"></span><br><span class="line"><span class="attr">scrape_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;prometheus&#x27;</span></span><br><span class="line">    <span class="attr">scrape_interval:</span> <span class="string">5s</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;localhost:9090&#x27;</span>]</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;node_exporter&#x27;</span></span><br><span class="line">    <span class="attr">scrape_interval:</span> <span class="string">5s</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;localhost:9100&#x27;</span>]       </span><br></pre></td></tr></table></figure>
<p>Save the file and exit your text editor when you’re ready to continue.</p>
<p>Finally, restart Prometheus to put the changes into effect.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">sudo</span> <span class="string">systemctl</span> <span class="string">restart</span> <span class="string">prometheus</span></span><br></pre></td></tr></table></figure>
<p>Once again, verify that everything is running correctly with the status command.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">sudo</span> <span class="string">systemctl</span> <span class="string">status</span> <span class="string">prometheus</span></span><br></pre></td></tr></table></figure>
<p>If the service’s status isn’t set to active, follow the on screen instructions and re-trace your previous steps before moving on.</p>
<p>We now have Prometheus and Node Exporter installed, configured, and running. As a final precaution before connecting to the web interface, we’ll enhance our installation’s security with basic HTTP authentication to ensure that unauthorized users can’t access our metrics.</p>
<br>

<hr>
<h2 id="Secure-Prometheus"><a href="#Secure-Prometheus" class="headerlink" title="Secure Prometheus"></a>Secure Prometheus</h2><p>Prometheus does not include built-in authentication or any other general purpose security mechanism. On the one hand, this means you’re getting a highly flexible system with fewer configuration restraints; on the other hand, it means it’s up to you to ensure that your metrics and overall setup are sufficiently secure.</p>
<p>For simplicity’s sake, we’ll use Nginx to add basic HTTP authentication to our installation, which both Prometheus and its preferred data visualization tool, Grafana, fully support.</p>
<p>Start by installing apache2-utils, which will give you access to the htpasswd utility for generating password files.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install apache2-utils</span><br></pre></td></tr></table></figure>
<p>Now, create a password file by telling <code>htpasswd</code> where you want to store the file and which username you’d like to use for authentication.</p>
<blockquote>
<p>Note: <code>htpasswd</code> will prompt you to enter and re-confirm the password you’d like to associate with this user. Also, make note of both the username and password you enter here, as you’ll need them to log into Prometheus in Step 9.</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">sudo</span> <span class="string">htpasswd</span> <span class="string">-c</span> <span class="string">/etc/nginx/.htpasswd</span> <span class="string">merikanto</span></span><br></pre></td></tr></table></figure>
<p>The result of this command is a newly-created file called .htpasswd, located in the /etc/nginx directory, containing the username and a hashed version of the password you entered.</p>
<p>Next, configure Nginx to use the newly-created passwords.</p>
<p>First, make a Prometheus-specific copy of the default Nginx configuration file so that you can revert back to the defaults later if you run into a problem.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">sudo</span> <span class="string">cp</span> <span class="string">/etc/nginx/sites-available/default</span> <span class="string">/etc/nginx/sites-available/prometheus</span></span><br></pre></td></tr></table></figure>
<p>Then, open the new configuration file.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">sudo</span> <span class="string">vim</span> <span class="string">/etc/nginx/sites-available/prometheus</span></span><br></pre></td></tr></table></figure>
<p>Locate the location / block under the server block. It should look like:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/nginx/sites-available/default</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line">    <span class="string">location</span> <span class="string">/</span> &#123;</span><br><span class="line">        <span class="string">try_files</span> <span class="string">$uri</span> <span class="string">$uri/</span> <span class="string">=404;</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure>
<p>As we will be forwarding all traffic to Prometheus, replace the try_files directive with the following content:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/nginx/sites-available/prometheus</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line">    <span class="string">location</span> <span class="string">/</span> &#123;</span><br><span class="line">        <span class="string">auth_basic</span> <span class="string">&quot;Prometheus server authentication&quot;</span><span class="string">;</span></span><br><span class="line">        <span class="string">auth_basic_user_file</span> <span class="string">/etc/nginx/.htpasswd;</span></span><br><span class="line">        <span class="string">proxy_pass</span> <span class="string">http://localhost:9090;</span></span><br><span class="line">        <span class="string">proxy_http_version</span> <span class="number">1.1</span><span class="string">;</span></span><br><span class="line">        <span class="string">proxy_set_header</span> <span class="string">Upgrade</span> <span class="string">$http_upgrade;</span></span><br><span class="line">        <span class="string">proxy_set_header</span> <span class="string">Connection</span> <span class="string">&#x27;upgrade&#x27;</span><span class="string">;</span></span><br><span class="line">        <span class="string">proxy_set_header</span> <span class="string">Host</span> <span class="string">$host;</span></span><br><span class="line">        <span class="string">proxy_cache_bypass</span> <span class="string">$http_upgrade;</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure>
<p>These settings ensure that users will have to authenticate at the start of each new session. Additionally, the reverse proxy will direct all requests handled by this block to Prometheus.</p>
<p>When you’re finished making changes, save the file and close your text editor.</p>
<p>Now, deactivate the default Nginx configuration file by removing the link to it in the /etc/nginx/sites-enabled directory, and activate the new configuration file by creating a link to it.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo rm /etc/nginx/sites-enabled/default</span><br><span class="line">sudo ln -s /etc/nginx/sites-available/prometheus /etc/nginx/sites-enabled/</span><br></pre></td></tr></table></figure>
<p>Before restarting Nginx, check the configuration for errors using the following command:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">sudo</span> <span class="string">nginx</span> <span class="string">-t</span></span><br></pre></td></tr></table></figure>
<p>The output should indicate that the syntax is ok and the test is successful. If you receive an error message, follow the on-screen instructions to fix the problem before proceeding to the next step.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Output of Nginx configuration tests</span></span><br><span class="line">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /etc/nginx/nginx.conf <span class="built_in">test</span> is successful</span><br></pre></td></tr></table></figure>
<p>Then, reload Nginx to incorporate all of the changes.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">sudo</span> <span class="string">systemctl</span> <span class="string">reload</span> <span class="string">nginx</span></span><br></pre></td></tr></table></figure>
<p>Verify that Nginx is up and running.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">sudo</span> <span class="string">systemctl</span> <span class="string">status</span> <span class="string">nginx</span></span><br></pre></td></tr></table></figure>
<p>If your output doesn’t indicate that the service’s status is active, follow the on-screen messages and re-trace the preceding steps to resolve the issue before continuing.</p>
<p>At this point, we have a fully-functional and secured Prometheus server, so we can log into the web interface to begin looking at metrics.</p>
<br>

<hr>
<h2 id="Test-Prometheus"><a href="#Test-Prometheus" class="headerlink" title="Test Prometheus"></a>Test Prometheus</h2><p>Prometheus provides a basic web interface for monitoring the status of itself and its exporters, executing queries, and generating graphs. But, due to the interface’s simplicity, the Prometheus team recommends installing and using Grafana for anything more complicated than testing and debugging.</p>
<p>In this post, we’ll use the built-in web interface to ensure that Prometheus and Node Exporter are up and running, and we’ll also take a look at simple queries and graphs.</p>
<p>To begin, point your web browser to <a target="_blank" rel="noopener" href="http://your_server_ip/">http://your_server_ip</a>.</p>
<p>In the HTTP authentication dialogue box, enter the username and password you chose in Step 8.</p>
<p><img data-src="/images/posts/190814-1.png" alt="01"></p>
<p>Once logged in, you’ll see the Expression Browser, where you can execute and visualize custom queries.</p>
<p><img data-src="/images/posts/190814-2.png" alt="02"></p>
<p>Before executing any expressions, verify the status of both Prometheus and Node Explorer by clicking first on the Status menu at the top of the screen and then on the Targets menu option. As we have configured Prometheus to scrape both itself and Node Exporter, you should see both targets listed in the UP state.</p>
<p><img data-src="/images/posts/190814-3.png" alt="03"></p>
<p>If either exporter is missing or displays an error message, check the service’s status with the following commands:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl status prometheus</span><br><span class="line">sudo systemctl status node_exporter</span><br></pre></td></tr></table></figure>
<p>The output for both services should report a status of Active: active (running). If a service either isn’t active at all or is active but still not working correctly, follow the on-screen instructions and re-trace the previous steps before continuing.</p>
<p>Next, to make sure that the exporters are working correctly, we’ll execute a few expressions against Node Exporter.</p>
<p>First, click on the Graph menu at the top of the screen to return to the Expression Browser.</p>
<p><img data-src="/images/posts/190814-4.png" alt="04"></p>
<p>In the Expression field, type node_memory_MemAvailable and press the Execute button to update the Console tab with the amount of memory your server has.</p>
<p><img data-src="/images/posts/190814-5.png" alt="05"></p>
<p>By default, Node Exporter reports this amount in bytes. To convert to megabytes, we’ll use math operators to divide by 1024 twice.</p>
<p>In the Expression field, enter node_memory_MemAvailable/1024/1024 and then press the Execute button.</p>
<p><img data-src="/images/posts/190814-6.png" alt="06"><br>The Console tab will now display the results in megabytes.</p>
<p>If you want to verify the results, execute the free command from your terminal. (The -h flag tells free to report back in a human-readable format, giving us the amount in megabytes.)</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">free</span> <span class="string">-h</span></span><br></pre></td></tr></table></figure>
<p>This output contains details about memory usage, including available memory displayed in the available column.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           488M        144M         17M        3.7M        326M        324M</span><br><span class="line">Swap:            0B          0B          0B</span><br></pre></td></tr></table></figure>
<p>In addition to basic operators, the Prometheus query language also provides many functions for aggregating results.</p>
<p>In the Expression field, type avg_over_time(node_memory_MemAvailable[5m])/1024/1024 and click on the Execute button. The result will be the average available memory over the last 5 minutes in megabytes.</p>
<p><img data-src="/images/posts/190814-7.png" alt="07"></p>
<p>Now, click on the Graph tab to display the executed expression as a graph instead of as text.</p>
<p><img data-src="/images/posts/190814-8.png" alt="08"></p>
<p>Finally, while still on this tab, hover your mouse over the graph for additional details about any specific point along the graph’s X and Y axes.</p>
<p>If you’d like to learn more about creating expressions in Prometheus’ built-in web interface, see the Querying Prometheus portion of the official documentation.</p>
<br>

<br>
    </div>

    
    
    <div>
    
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>Beitragsautor:  </strong>Merikanto
  </li>
  <li class="post-copyright-link">
    <strong>Beitragslink: </strong>
    <a href="http://merikanto.org/2019/Prometheus/" title="Configure Prometheus on Ubuntu">http://merikanto.org/2019/Prometheus/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Urheberrechtshinweis:  </strong>Alle Artikel in diesem Blog sind unter <a target="_blank" rel="noopener" href="https://github.com/Merikanto">Merikanto</a> lizenziert, außer es wird anders angegeben.
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/DevOps/" rel="tag"><i class="fa fa-tag"></i> DevOps</a>
              <a href="/tags/Linux/" rel="tag"><i class="fa fa-tag"></i> Linux</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2019/Zabbix/" rel="prev" title="Monitor Remote Servers with Zabbix">
      <i class="fa fa-chevron-left"></i> Monitor Remote Servers with Zabbix
    </a></div>
      <div class="post-nav-item">
    <a href="/2019/Kubernetes-Docker-Compose/" rel="next" title="Migrate a Docker Compose Workflow to Kubernetes">
      Migrate a Docker Compose Workflow to Kubernetes <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



        </div>
        
    
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2016 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>  
  </span>
  <a href="/tools"><span class="author" itemprop="copyrightHolder">Merikanto</span></a>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Alle Besucher">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Alle Aufrufe">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>


  




  
<script src="/js/local-search.js"></script>











<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.init({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    }, '.mermaid');
  }, window.mermaid);
}
</script>


  

  
<script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>

<script>
var options = {
  bottom: '64px',
  right: 'unset',
  left: '32px',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#ededed',
  buttonColorLight: '#4a4a4a',
  saveInCookies: true,
  label: '◒',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script>

<script>
  var disqus_config = function() {
    this.page.url = "http://merikanto.org/2019/Prometheus/";
    this.page.identifier = "2019/Prometheus/";
    this.page.title = "Configure Prometheus on Ubuntu";
    };
  NexT.utils.loadComments('#disqus_thread', () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://Merikanto-Blog.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>


  <script async src="/js/cursor/love.min.js"></script>

</body>
</html>
